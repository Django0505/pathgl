<!DOCTYPE html>
<head>
	<meta charset="utf-8">
  <meta name="viewport"
	      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>WebGL Library for Data Visualization and Simulation - PathGL</title>
	
	<script src="/lib/d3.js"></script>
	<script src="/lib/topojson.v1.min.js"></script>
	<script src="/lib/projection.js"></script>
	<script src="/lib/tip.js"></script>
	<script src="../heatmap.js"></script>
		
	<script src="/dist/pathgl.js"></script>
  <link rel="stylesheet" href="/lib/adnan.css">
</head>

<body class="mosaic examples">
  <div class="nav">
    <a href="http://github.com/adnan-wahab/pathgl">Github Repo</a>
    <a href="/dist/pathgl.zip">Download</a>

		<h3>Examples</h3>
		<ul class="examples">
			<li class="mobile-only"><a href="/examples/swarm.html">200k Circles</a>
			<li class="desktop-only"><a href="/examples/physics.html">Particle Simulation</a>
      <li><a href="/examples/map.html">Map of History</a>
      <li><a href="/examples/music.html">Music Visualizer</a>
    </ul>
		
		<h3>Documentation</h3>
		<ul class="docs">
			<li><a href="/documentation/start.html">Getting Started</a>
			<li><a href="/documentation/api.html">API Reference</a>
      <li><a href="/documentation/webgl.html">The Graphics Pipeline</a>
			<li><a href="/documentation/svg.html">SVG Differences</a>
			<li><a href="/documentation/gpgpu.html">GPGPU</a>
		</ul>
		<div class="mode">
			<h3>Rendering Mode</h3>
			<label for="svg">SVG<input type="radio" name="mode" id="svg"></label>
			<label for="webgl">WebGL<input type="radio" name="mode" checked="1" id="webgl"></label>
			<img class="t" src="data/test.png">
			<img class="l" src="data/leaves.jpg">
		</div>
	</div>
	<div class="right" id="scroll">
		<div class="blurb"><!--blurb--></div>
		<canvas width="960" height="500"></canvas>
		<svg></svg>
		<script>
d3.json('https://api.imgur.com/3/gallery/r/foodporn/top/1')
.header("Authorization", 'Client-Id 9e7ab6a35eb2f7a')
.header("Accept", 'application/json')
.get(function (err, data) {
  if (err) throw new Error(err)
  else
    init(data.data.filter(function(d) { return ! d.nsfw && d.type })
         .map(function (d) { return d.link })
        )
})

var width = ~~ (.8 * innerWidth)
  , height = ~~ (innerHeight * .9)

var c = d3.select('canvas')
        .attr('height', height)
        .attr('width', width)

var col = 30
  , s = ~~ (width / col)
  , row = ~~ (height / s)

var findAverageHue = 'vec4 accumulator (vec4 a, vec4 b) {'
                   + '  return vec4(a.x + b.x, 0, a.z, a.w);'
                   + '}'

function init(arr) {
  arr.width = 1024
  arr.rows = 8
  //tiles = pathgl.texture(getWebcam()).repeat()
  tiles = pathgl.texture(arr)//.pipe(mozify)
  c.selectAll('rect').data(d3.range(col * row ))
  .enter().append('rect')
  .attr('x', function (d) { return s/2 + s * (d % col) })
  .attr('y', function (d) { return s/2 + s * ~~(d / col) })
  .attr('width', s / 2)
  .filter(function (d, i) { return (d % 30) < 15 })
  .attr('fill', tiles)

  return
  var mozify = pathgl.shader().matchWith(findAverageHue)
  var webcam = pathgl.texture(getWebcam()).repeat().pipe(mozify)
  var mosaic = pathgl.texture()
  return mosaic
}

//var webcam = pathgl.texture(getWebcam()).repeat()

function getWebcam() {
  navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia
  var video = d3.select('body').append('video')
              .attr('height', '1024').attr('width', 'auto')
              .attr('autoplay', true).attr('loopo', true)
              //.style('display', 'none')
              .node()

  navigator.getUserMedia({ video: true }, function(stream) {
    video.src = window.URL.createObjectURL(stream)
  }, function(error) {})

  var c = document.createElement('canvas').getContext('2d')
    , s = c.canvas.width = c.canvas.height = 1024

  return video
}
</script><p>Intake video stream and swap 50px tiles with images from imgur to create a realtime
video mosaic. 
</p><code>d3.json('https://api.imgur.com/3/gallery/r/foodporn/top/1')
.header("Authorization", 'Client-Id 9e7ab6a35eb2f7a')
.header("Accept", 'application/json')
.get(function (err, data) {
  if (err) throw new Error(err)
  else
    init(data.data.filter(function(d) { return ! d.nsfw && d.type })
         .map(function (d) { return d.link })
        )
})

var width = ~~ (.8 * innerWidth)
  , height = ~~ (innerHeight * .9)

var c = d3.select('canvas')
        .attr('height', height)
        .attr('width', width)

var col = 30
  , s = ~~ (width / col)
  , row = ~~ (height / s)

var findAverageHue = 'vec4 accumulator (vec4 a, vec4 b) {'
                   + '  return vec4(a.x + b.x, 0, a.z, a.w);'
                   + '}'

function init(arr) {
  arr.width = 1024
  arr.rows = 8
  //tiles = pathgl.texture(getWebcam()).repeat()
  tiles = pathgl.texture(arr)//.pipe(mozify)
  c.selectAll('rect').data(d3.range(col * row ))
  .enter().append('rect')
  .attr('x', function (d) { return s/2 + s * (d % col) })
  .attr('y', function (d) { return s/2 + s * ~~(d / col) })
  .attr('width', s / 2)
  .filter(function (d, i) { return (d % 30) < 15 })
  .attr('fill', tiles)

  return
  var mozify = pathgl.shader().matchWith(findAverageHue)
  var webcam = pathgl.texture(getWebcam()).repeat().pipe(mozify)
  var mosaic = pathgl.texture()
  return mosaic
}

//var webcam = pathgl.texture(getWebcam()).repeat()

function getWebcam() {
  navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia
  var video = d3.select('body').append('video')
              .attr('height', '1024').attr('width', 'auto')
              .attr('autoplay', true).attr('loopo', true)
              //.style('display', 'none')
              .node()

  navigator.getUserMedia({ video: true }, function(stream) {
    video.src = window.URL.createObjectURL(stream)
  }, function(error) {})

  var c = document.createElement('canvas').getContext('2d')
    , s = c.canvas.width = c.canvas.height = 1024

  return video
}</code>
  </div>
</body>