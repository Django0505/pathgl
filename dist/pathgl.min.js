!function(){function t(){}function e(t){return t}function n(t){return this.push(t)}function i(t){return Math.pow(Math.ceil(Math.sqrt(t)),2)}function r(t,e){for(var n in t)e(t[n],n,t)}function o(){return[-1,-1,1,-1,-1,1,1,1]}function a(t){return t.split(".").pop().join().match(/mp4|ogg|webm/)}function s(t,e){if(arguments.length>2)[].forEach.call(arguments,function(e){s(t,e)});else for(var n in e)t[n]=e[n];return t}function u(t){var e=h(t);return+(255*e[0])<<16^255*e[1]<<8^255*e[2]<<0}function c(t){return t=Math.floor(t),[(255&t>>16)/255,(255&t>>8)/255,(255&t)/255]}function f(t,e,n){if(0===e)return[n,n,n];var i=.5>=n?n*(1+e):n+e-n*e,r=2*n-i;return[l(r,i,t+1/3),l(r,i,t),l(r,i,t-1/3)]}function l(t,e,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?t+6*(e-t)*n:.5>n?e:2/3>n?t+6*(e-t)*(2/3-n):t}function h(t){if(he[t])return c(he[t]);if(/^hsl/i.test(t)){var e=t.split(/,|\(/).map(parseFloat);return f(e[1]/360,e[2]/100,e[3]/100)}if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(t)){var n=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(t);return[Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255]}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(t)){var n=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(t);return[Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100]}if(/^\#([0-9a-f]{6})$/i.test(t)){var n=/^\#([0-9a-f]{6})$/i.exec(t);return c(parseInt(n[1],16))}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)){var n=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t);return c(parseInt(n[1]+n[1]+n[2]+n[2]+n[3]+n[3],16))}return!1}function d(){function t(){return a=[].slice.call(arguments),a.forEach(function(t){t.register(s)}),o=o||a.width,this}function e(){return this}function n(t){return s.render=new Q(t,{width:a[0].width,height:a[0].height,texture:a[0].texture}),this}function i(){return this}function r(){return this}var o,a=[],s={read:t,write:e,map:n,match:i,exec:r};return s}function p(t,e,n,i){function r(e,n){var i,r=t.getUniformLocation(ue,e),o="uniform"+v(n)+"fv";ue[e]=function(e){i!=e&&arguments.length&&(t[o](r,Array.isArray(e)?e:[e]),i=e)}}var o=e+"\n"+n;if(ue=t.createProgram(),e=m(t,t.VERTEX_SHADER,e),n=m(t,t.FRAGMENT_SHADER,n),t.attachShader(ue,e),t.attachShader(ue,n),t.deleteShader(e),t.deleteShader(n),(i||["pos","color","fugue"]).forEach(function(e,n){t.bindAttribLocation(ue,n,e)}),t.linkProgram(ue),t.useProgram(ue),!t.getProgramParameter(ue,t.LINK_STATUS))throw name+": "+t.getProgramInfoLog(ue);for(var a=/uniform\s+(\S+)\s+(\S+)\s*;/g,s=null;null!=(s=a.exec(o));)r(s[2],s[1]);return ue}function g(t){var e=oe.vertexShader;r(t||{},function(t,e,n){"cx"==e&&(n.x=t),"cy"==e&&(n.y=t)});var n=s({stroke:"(color.r < 0.) ? vec4(stroke) : unpack_color(stroke)",r:"(pos.z < 0.) ? 1. + ( abs(texture2D(texture, abs(pos.xy)).w) + abs(texture2D(texture, abs(pos.xy)).z))  : (2. * pos.z)",x:"(pos.x < 1.) ? texture2D(texture, abs(pos.xy)).x * resolution.x : pos.x",y:"(pos.y < 1.) ? texture2D(texture, abs(pos.xy)).y * resolution.y: pos.y"},t);for(var i in n)e=e.replace("replace_"+i,n[i]);return e}function m(t,e,n){var i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(i)||"",o=+r.split(":")[2];return console.error((n||"").split("\n").slice(o-5,o+5).join("\n"),r)}return i}function v(t){return t.match("vec")?t[t.length-1]:1}function _(t){if(!(se=A(canvas=t)))return!!console.log("webGL context could not be initialized");se.getExtension("OES_texture_float")||console.warn("does not support floating point textures"),ue=p(se,g(),oe.fragmentShader),canvas.program=ue,T(canvas),x(canvas);var e=L(canvas);return ce.push(e.update),se.clearColor(.3,.3,.3,1),y(se),S(),canvas}function y(t){t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)}function x(t){function e(){oe.uniform("resolution",[t.width||960,t.height||500])}setInterval(e,100),t.addEventListener("click",E),t.addEventListener("mousemove",b),t.addEventListener("touchmove",w),t.addEventListener("touchstart",w)}function E(){}function b(t){var e=canvas.getBoundingClientRect();oe.uniform("mouse",[t.clientX-e.left-canvas.clientLeft,t.clientY-e.top-canvas.clientTop])}function w(t){var e=canvas.getBoundingClientRect();t=t.touches[0],oe.uniform("mouse",[t.clientX-e.left-canvas.clientLeft,t.clientY-e.top-canvas.clientTop])}function T(t){window.d3&&s(window.d3.selection.prototype,{vAttr:R,shader:k}),window.d3&&s(window.d3.transition.prototype,{vAttr:R,shader:k}),s(t,de).gl=se}function A(t){var e=t.getContext("webgl")||t.getContext("experimental-webgl");return e&&s(e,{viewportWidth:t.width,viewportHeight:t.height})}function R(t,e){return this.each(function(t,n){this.colorBuffer[this.indices[0]]=u(e(t,n))}),this}function k(t){return this.node().mesh.mergeProgram(t),this}function S(){ce.forEach(function(t){t()}),pe(S)}function B(t){var e=[],n=this.buffer,i=this.posBuffer,r=this.indices,o=[0,0],a=r.length,s=0,u=[0,0];for(t.match(/[a-z][^a-z]*/gi).forEach(function(t){for(var n=t.slice(1).trim().split(/,| /g),i=t[0].toLowerCase(),r=0;r<n.length;){var a=n[r++],s=n[r++];"m"==i?u=o=[a,s]:"l"==i?e.push(o[0],o[1],a,s)&&(o=[a,s]):"z"==i?e.push(o[0],o[1],u[0],u[1])&&(o=u):console.log("%d method is not supported malformed path:",i)}});r.length<e.length;)r.push(n.count+s++);r.length>e.length&&(r.length=e.length),r.forEach(function(t,r){i[3*n[t]+t%3]=r<e.length&&e[r]}),n.count+=e.length-a}function F(){if(!d3)return console.warn("this method depends on d3");d3.selectAll("link[rel=styleSheet]").each(function(){d3.text});var t=d3.selectAll("style")[0].map(function(){return this.sheet}).reduce(function(t,e){var n={};return r(e.cssRules,function(t){for(var e=t.length,i={};e--;){var r=t[t[e]];i[r]=t[r]}n[t.selectorText]=i}),s(t,n)},{});r(t,function(t,e){d3.select(e).attr(t)})}function D(t,e){function n(){return h+="points"==e.primitive?1:"lines"==e.primitive?2:3}function i(){d.forEach(function(n,i){var r=t.createBuffer(),o=e[n]||{};t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,4e7,t.STREAM_DRAW),l[n]={array:new Float32Array(e[n]&&e[n].array||4e5),buffer:r,size:o.size||4,changed:!0,loc:i}})}function r(t){var e,n;for(n in l)for(n=l,e=n.size;e--;)l[t*n.size+e]=0}function o(t){t.posBuffer=l.pos.array,t.fBuffer=l.fugue.array,t.colorBuffer=l.color.array,t.mesh=this}function a(e){if(h){for(var n in l)n=l[n],t.bindBuffer(t.ARRAY_BUFFER,n.buffer),t.vertexAttribPointer(n.loc,n.size,t.FLOAT,!1,0,0),t.enableVertexAttribArray(n.loc),n.changed&&t.bufferSubData(t.ARRAY_BUFFER,0,n.array);t.drawArrays(p,e||0,h)}}function s(){}function u(){}function c(){}function f(){}var l={},h=e.count||0,d=e.attrList||["pos","color","fugue"],p=t[e.primitive.toUpperCase()];return i(),{init:i,free:r,alloc:n,draw:a,bind:o,attributes:l,set:s,addAttr:u,removeAttr:c,boundingBox:f}}function L(t){function e(t){return(l[t.toLowerCase()]||console.log.bind(console,"oops"))(t)}function n(t){f=p(s,g(t),oe.fragmentShader)}function i(){for(ue!=f&&s.useProgram(ue=f),s.bindFramebuffer(s.FRAMEBUFFER,c),o(),r(),a(s),oe.uniform("clock",new Date-le),u=-1;++u<h.length;)h[u].draw()}function r(){for(var t in fe)ue[t]&&ue[t](fe[t])}function o(){t.texture&&s.bindTexture(s.TEXTURE_2D,t.texture)}function a(e){c||e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,t.width,t.height)}var s=t.gl,u=0,c=t.fbo||null,f=t.program,l=t.types=Y(),h=z(s,t.types);return t.mesh&&h.push(t.mesh),h.forEach(function(t){t.mergeProgram=n}),M.call(t),t.__renderTarget__={update:i,append:e}}function z(t,e){var n=new D(t,{primitive:"points"});n.bind(e.circle),n.bind(e.rect);var i=new D(t,{primitive:"lines",pos:{size:2}});return i.bind(e.line),[n,i]}function M(){this.fbo&&(se.bindFramebuffer(se.FRAMEBUFFER,this.fbo),this.fbo.width=screen.width,this.fbo.height=screen.height,se.framebufferTexture2D(se.FRAMEBUFFER,se.COLOR_ATTACHMENT0,se.TEXTURE_2D,this.texture,null),se.bindFramebuffer(se.FRAMEBUFFER,null))}function C(t,e){return t.replace(/^\s+|\s*([,\s\+\~>]|$)\s*/g,"$1").split(",").forEach(function(t){U(t,this).forEach(n.bind(e=[]))},this)||e}function U(t,e){var n,i=t.split(/[\s\>\+\~](?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),r=t.match(/([\s\>\+\~])(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),o=I(i.pop()),a=[],s=[];return G.call(e,o[1]||"*").forEach(function(t){(n=q.apply(t,o))&&a.push(n)}),i.length?a.forEach(function(t){P(t,i,r)&&s.push(t)})||s:a}function P(t,e,n,i){return i=function r(t,o,a){for(;a=me[n[o]](a,t);)if(q.apply(a,I(e[o]))&&o)return(i=r(a,o-1,a))?i:a}(t,e.length-1,t)}function q(t,e,n,i,r,o,a,t,s,t,u,c){return s&&ge[s]&&!ge[s](this,u)||e&&"*"!==e&&this.tag&&this.tag.toLowerCase()!==e||i&&!N(o,this.attr[r]||"",a)||n&&(c=n.match(/#([\w\-]+)/))&&c[1]!==this.attr.id||n&&(n.match(/\.[\w\-]+/g)||[]).some(X.bind(this))?0:this}function N(t,e,n){return e.match(RegExp({"=":n,"^=":"^"+$(n),"$=":$(n)+"$","*=":$(n),"~=":"(?:^|\\s+)"+$(n)+"(?:\\s+|$)","|=":"^"+$(n)+"(-|$)"}[t]||"adnan^"))}function I(t){return t.match(ve)}function O(t){for(;t=t.previousSibling();)if(t.top)return t}function $(t){return t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/,"\\$1")}function X(t){return!RegExp("(^|\\s+)"+t.slice(1)+"(\\s+|$)").test(this.attr.class)}function G(t){return j(this,function(e){return"*"==t||e.tagName==t},[])}function j(t,e,n){return(t.__scene__||t.children).forEach(function(t){j(t,e,n),e(t)&&n.push(t)})||n}function Y(){return xe.reduce(function(t,e){return t[e.name]=function n(){var t=Object.create(e.prototype);return s(t,n),t.init(n.mesh.alloc()-1),t.attr={},t},s(e.prototype,ye,_e[e.name]),t},{})}function H(t){B.call(this,t,this.stroke(this.attr.stroke)),this.stroke(this.attr.stroke)}function V(t,e){var n=canvas.__scene__,i=n.indexOf(e);reverseEach(n.slice(i,n.push(0)),function(t,e){n[e]=n[e-1]}),n[i]=t}function W(t){return this.__scene__[this.__scene__.length]=this.__renderTarget__.append(t.tagName)}function K(t){var e=this.__scene__.indexOf(t);t=this.__scene__.splice(e,1)[0],t&&t.mesh.free(e)}function J(t,e){s(this,{fbo:se.createFramebuffer(),program:t||ue,gl:se,texture:se.createTexture(),width:512,height:512,mesh:D(se,{pos:{array:o(),size:2},attrList:["pos"],count:4,primitive:"triangle_strip"})},e),this.texture.unit=0,this.init(),this.__renderTarget__=L(this),console.log("beforestart"),this.update=function(){this.step&&this.step(),this.__renderTarget__.update(),this.__renderTarget__.update()}}function Q(t,e){var n=p(se,be,t,["pos"]);return s(e,{}),new J(n,e)}function Z(t,e){"string"==typeof t&&(t=ee(t)),"number"==typeof t&&(e.width=e.height=Math.sqrt(t),t=!1),s(this,{gl:se,data:t,texture:se.createTexture(),width:t.width||512,height:t.height||512},e),this.load()}function te(){se.bindTexture(se.TEXTURE_2D,this.texture),se.pixelStorei(se.UNPACK_FLIP_Y_WEBGL,!0),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MAG_FILTER,se.NEAREST),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MIN_FILTER,se.NEAREST),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),this.update()}function ee(t){var e=document.querySelector(t);return e?e:s(a?new Image:document.createElement("video"),{src:t})}function ne(){}function ie(){for(var t=this.size()||0,e=new Array(t);t--;)e[t]={x:this.x()(t,t),y:this.y(t,t)(t,t),z:this.z(t,t)(t,t)};return e}function re(t,e){return Math.random()*(e-t)}var oe=this.pathgl={};oe.sim={},oe.stop=function(){},oe.context=function(){return se};var ae=0;oe.texture=function(t,e,n){return ae||oe.init("canvas"),new(null==t?J:Z)(t,s(e||{},{src:t}),n)},oe.uniform=function(t,e){return 1==arguments.length?fe[t]:fe[t]=e},oe.applyCSS=F,HTMLCanvasElement.prototype.appendChild=function(t){return oe.init(this)?this.appendChild(t):void 0};var se,ue,ce=[],fe={},le=Date.now();oe.init=function(t){return ae=1,t="string"==typeof t?document.querySelector(t):t instanceof d3.selection?t.node():t,t.getContext?!!_(t):console.log(t,"is not a valid canvas")};var he={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};oe.shader=d,oe.vertexShader=["precision mediump float;","uniform float clock;","uniform vec2 mouse;","uniform vec2 resolution;","uniform vec2 dates;","attribute vec4 pos;","attribute vec4 color;","attribute vec4 fugue;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","uniform sampler2D texture;","const mat4 modelViewMatrix = mat4(1.);","const mat4 projectionMatrix = mat4(1.);","vec4 unpack_color(float col) {","    return vec4(mod(col / 256. / 256., 256.),","                mod(col / 256. , 256.),","                mod(col, 256.),","                200.)","                / 256.;","}","void main() {","    float time = clock / 1000.;","    float x = replace_x;","    float y = replace_y;","    float fill = color.x;","    float stroke = color.x;","    gl_Position = vec4(2. * (x / resolution.x) - 1., 1. - ((y / resolution.y) * 2.),  1., 1.);","    type = fugue.x;","    gl_PointSize =  replace_r;","    v_fill = unpack_color(fill);","    v_stroke = replace_stroke;","}"].join("\n\n"),oe.fragmentShader=["precision mediump float;","uniform sampler2D texture;","uniform vec2 resolution;","uniform vec2 dates;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","void main() {","    float dist = distance(gl_PointCoord, vec2(0.5));","    if (type == 1. && dist > 0.5) discard;","    gl_FragColor = (v_stroke.x < 0.) ? texture2D(texture, gl_PointCoord) : v_stroke;","}"].join("\n");var de={appendChild:W,querySelectorAll:C,querySelector:function(t){return this.querySelectorAll(t)[0]},removeChild:K,insertBefore:V,__scene__:[],__pos__:[],__program__:void 0},pe=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},ge={},me={" ":function(t){return t&&t!==__scene__&&t.parent()},">":function(t,e){return t&&t.parent()==e.parent()&&t.parent()},"~":function(t){return t&&t.previousSibling()},"+":function(t,e,n,i){return!t||(n=O(t))&&(i=O(e))&&n==i&&n}},ve=/^(\*|\w+)?(?:([\.\#]+[\w\-\.#]+)?)(\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\])?(:([\w\-]+)(\(['"]?([^()]+)['"]?\))?)?/,_e={circle:{init:function(t){this.fBuffer[4*t]=1,this.indices=[4*t]},cx:function(t){this.posBuffer[this.indices[0]+0]=t},cy:function(t){this.posBuffer[this.indices[0]+1]=t},r:function(t){this.posBuffer[this.indices[0]+2]=t},cz:function(t){this.posBuffer[this.indices[0]+3]=t},fill:function(t){this.colorBuffer[this.indices[0]]=0>t?t:u(t)},stroke:function(t){this.colorBuffer[this.indices[0]]=u(t)},opacity:function(){},tagName:"circle",schema:"cx cy r cz".split(" ")},ellipse:{init:function(){},tagName:"ellipse",cx:t,cy:t,rx:t,ry:t},rect:{init:function(t){this.fBuffer[4*t]=0,this.indices=[4*t]},tagName:"rect",fill:function(t){this.colorBuffer[this.indices[0]]=0>t?t:u(t)},x:function(t){this.posBuffer[this.indices[0]+0]=t},y:function(t){this.posBuffer[this.indices[0]+1]=t},width:function(t){this.posBuffer[this.indices[0]+2]=t},height:function(t){this.posBuffer[this.indices[0]+3]=t},rx:t,ry:t},image:{init:function(){},tagName:"image","xlink:href":t,height:t,width:t,x:t,y:t},line:{init:function(t){this.indices=[2*t,2*t+1]},tagName:"line",x1:function(t){this.posBuffer[2*this.indices[0]]=t},y1:function(t){this.posBuffer[2*this.indices[0]+1]=t},x2:function(t){this.posBuffer[2*this.indices[1]]=t},y2:function(t){this.posBuffer[2*this.indices[1]+1]=t},stroke:function(t){var e=u(t);this.indices.forEach(function(t){this.colorBuffer[4*t]=parseInt(e.toString().slice(1),16)},this)}},path:{init:function(){},tagName:"path",d:H,pathLength:t,stroke:function(t){var e=u(t);this.indices.forEach(function(t){this.colorBuffer[t]=+parseInt(e.toString().slice(1),16)},this)}},polygon:{init:function(){},tagName:"polygon",points:t},polyline:{init:function(t){this.indices=[2*t,2*t+1]},tagName:"polyline",points:t},g:{init:function(){},tagName:"g",appendChild:function(t){this.children.push(W(t))},ctr:function(){this.children=[]}},text:{init:function(){},tagName:"text",x:t,y:t,dx:t,dy:t}},ye={querySelectorAll:C,children:Object.freeze([]),querySelector:function(t){return this.querySelectorAll(t)[0]},createElementNS:e,insertBefore:t,ownerDocument:{createElementNS:function(t,e){return e}},previousSibling:function(){canvas.scene[canvas.__scene__.indexOf(this)-1]},nextSibling:function(){canvas.scene[canvas.__scene__.indexOf()+1]},parent:function(){return __scene__},gl:se,transform:function(){},getAttribute:function(t){return this.attr[t]},setAttribute:function(t,e){e.ctr==Ee&&(e=+e),this.attr[t]=e,this[t]&&this[t](e)},style:{setProperty:t},removeAttribute:function(t){delete this.attr[t]},textContent:t,removeEventListener:t,addEventListener:addEventListener,ownerSVGElement:{createSVGPoint:function(){}}},xe=[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],Ee={init:te,pipe:ne,update:function(){this.data?se.texImage2D(se.TEXTURE_2D,0,se.RGBA,se.RGBA,se.UNSIGNED_BYTE,this.data):se.texImage2D(se.TEXTURE_2D,0,se.RGBA,this.width,this.height,0,se.RGBA,se.FLOAT,null)},size:function(t,e){return arguments.length?(e||(this.height=t),this.w=t,this):this.width*this.height},register:function(){},z:function(){var t=Math.sqrt(this.size());return function(e,n){return-1/t*~~(n%t)}},x:function(){var t=Math.sqrt(this.size());return function(e,n){return-1/t*~~(n%t)}},y:function(){var t=Math.sqrt(this.size());return function(e,n){return-1/t*~~(n/t)}},forEach:function(){},load:function(){var t=this.data;return!t||t.complete||4==t.readyState?this.init():t.addEventListener&&t.addEventListener("load",this.init.bind(this)),this},repeat:function(){return this.task=this.update.bind(this),ce.push(this.task),this},stop:function(){this.task&&ce.splice(ce.indexOf(this.task)),delete this.task},appendChild:function(t){return this.__scene__[this.__scene__.length]=this.__renderTarget__.append(t.tagName||t)},valueOf:function(){return-1},copy:function(){return oe.texture(this.src)},pipe:ne,querySelectorAll:C,__scene__:[],ownerDocument:{createElementNS:function(t,e){return e}},unwrap:ie};s(J.prototype,de,Ee,{update:function(){se.texImage2D(se.TEXTURE_2D,0,se.RGBA,this.width,this.height,0,se.RGBA,se.FLOAT,this.data||null)}}),s(Z.prototype,Ee,{});var be=["precision mediump float;","attribute vec2 pos;","  void main() {","  gl_Position = vec4(pos.xy, 1.0 , 1.0);","  }"].join("\n"),we=[,"precision mediump float;","uniform sampler2D texture;","uniform vec2 resolution;","uniform vec2 mouse;","uniform vec2 dimensions;","uniform float gravity;","uniform float inertia;","uniform float drag;","void main() {","vec2 TARGET = vec2(mouse / resolution);","vec4 data = texture2D(texture, (gl_FragCoord.xy) / dimensions);","vec2 pos = data.xy;","vec2 vel = data.zw;","if (pos.x > 1.) { vel.x *= -1.; pos.x = 1.; } ","if (pos.y > 1.) { vel.y *= -1.; pos.y = 1.; } ","if (pos.x < 0.) { vel.x *= -1.; pos.x = 0.; } ","if (pos.y < 0.) { vel.y *= -1.; pos.y = 0.; } ","pos += vel * inertia;","vel += gravity * normalize(TARGET - pos) * 0.05;","vel *= drag;","gl_FragColor = vec4(pos, vel);","}"].join("\n");Date.now(),oe.sim.particles=function(t){function e(){oe.uniform("gravity",-1*oe.uniform("gravity"))}function n(){console.log("start"),oe.uniform("dimensions",[a,u]),oe.uniform("gravity",1),oe.uniform("inertia",.005),oe.uniform("drag",.991),o(se,f.texture,t/2,[1,2].map(Math.random)),o(se,f.texture,t,[1,2].map(Math.random))}function r(e,n){o(se,f.texture,n||t*Math.random(),e||[0,0])}function o(e,n,i,r,o){o=o||{x:0,y:0},e.activeTexture(e.TEXTURE0+n.unit),e.bindTexture(e.TEXTURE_2D,n);var s=~~(c%a),f=~~(c/u),l=[{x:s,y:f,size:i}];!function v(t){var e=t.x+t.size;if(e>a){var n=e-a;t.size-=n,t={x:0,y:(t.y+1)%u,size:n},l.push(t),v(t)}}(l[0]);var h,d,p,g,m=1;for(h=0;h<l.length;h++){for(p=l[h],g=[],d=0;d<p.size;d++)g.push(r[0],r[1],o.x+m*re(-1,1),o.y+m*re(-1,1));e.texSubImage2D(e.TEXTURE_2D,0,p.x,p.y,p.size,1,e.RGBA,e.FLOAT,new Float32Array(g))}c+=i,c%=t}t=i(t);var a=Math.sqrt(t),u=a,c=0,f=oe.texture(t),l=oe.shader().read(f).map(we);return n(),s(l.render,{emit:r,reverse:e})}}();