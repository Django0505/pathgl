!function(){function t(e){function n(n){return e=n,q=e.programs=e.programs||{},t.shaderParameters.resolution=[e.width,e.height],Y=f(e),a(e),i(e),r(e),d3.timer(C),(q.point=s(H,G)).name="point",(q.line=s(Q,Z)).name="line",Y?e:null}function r(){Y.disable(Y.SCISSOR_TEST),Y.colorMask(!0,!0,!0,!0),Y.stencilMask(1,1,1,1),Y.disable(Y.BLEND),Y.enable(Y.CULL_FACE)}function i(t){d3.select(t).on("mousemove.pathgl",o)}function o(){var e=d3.mouse(this);t.mouse=[e[0]/innerWidth,e[1]/innerHeight]}function a(t){return N(t,{appendChild:P,querySelectorAll:querySelectorAll,querySelector:querySelector,removeChild:k,insertBefore:B,gl:Y,__scene__:[],__pos__:[],__program__:void 0})}function c(t,e){var n=Y.createShader(t);if(Y.shaderSource(n,e),Y.compileShader(n),!Y.getShaderParameter(n,Y.COMPILE_STATUS))throw e+" "+Y.getShaderInfoLog(n);return n}function s(e,n){if(M=Y.createProgram(),e=c(Y.VERTEX_SHADER,e),n=c(Y.FRAGMENT_SHADER,n),Y.attachShader(M,e),Y.attachShader(M,n),Y.deleteShader(e),Y.deleteShader(n),Y.linkProgram(M),Y.useProgram(M),!Y.getProgramParameter(M,Y.LINK_STATUS))throw name+": "+Y.getProgramInfoLog(M);return O(t.shaderParameters,u),M.vPos=Y.getAttribLocation(M,"pos"),Y.enableVertexAttribArray(M.vPos),M.vfill=Y.getAttribLocation(M,"fill"),Y.enableVertexAttribArray(M.vFill),M.vStroke=Y.getAttribLocation(M,"stroke"),Y.enableVertexAttribArray(M.vStroke),M}function u(t,e){var n=Y.getUniformLocation(M,e);(M["set"+e]=function(e){Y["uniform"+t.length+"fv"](n,Array.isArray(e)?e:[e])})(t)}function f(t){var e=t.getContext("webgl",{antialias:!1})||t.getContext("experimental-webgl");return e&&N(e,{viewportWidth:t.width,viewportHeight:t.height})}function l(){}function h(){}function d(){}function v(){}function _(){}function g(){}function p(){}function A(t){var e=[];return U(t,function(t,n){e.push([t,n,0])}),e}function m(t){var e=addToBuffer(this);if(e.length)return render();t.match(/[a-z][^a-z]*/gi).forEach(function(t,n,r){var i=z[t[0].toLowerCase()],o=t.slice(1).trim().split(/,| /g);return[].push.apply(e.coords,A(o)),i?"closePath"==i.name&&r[n+1]?i.call(e,r[n+1]):("function"==typeof i?1==o.length?i.call(e):U(o,i,e):console.error(i+" "+t[0]+" is not yet implemented"),void 0):void 0});var n=toBuffer(this.path.coords);this.path.length=0,this.path.push(n)}function b(t,e){pos=[t,e]}function y(t){W=pos,x.apply(this,/m/i.test(t)?t.slice(1).trim().split(/,| /g):this.coords[0])}function x(t,e){this.push(t,e,0)}function S(){if(K.count){"point"!==M.name&&Y.useProgram(M=q.point);for(var t in J)Y.bindBuffer(Y.ARRAY_BUFFER,J[t].buffer),Y.enableVertexAttribArray(J[t].vLoc),J[t].changed&&Y.bufferSubData(Y.ARRAY_BUFFER,J[t].list,Y.DYNAMIC_DRAW),Y.vertexAttribPointer(J[t].vLoc,J[t].length,Y.FLOAT,!1,0,0);Y.bindBuffer(Y.ARRAY_BUFFER,Y.createBuffer()),Y.enableVertexAttribArray(M.vPos),Y.bufferData(Y.ARRAY_BUFFER,X,Y.DYNAMIC_DRAW),Y.vertexAttribPointer(M.vPos,4,Y.FLOAT,!1,0,0),Y.bindBuffer(Y.ARRAY_BUFFER,Y.createBuffer()),Y.enableVertexAttribArray(M.vStroke),Y.bufferData(Y.ARRAY_BUFFER,j,Y.DYNAMIC_DRAW),Y.vertexAttribPointer(M.vStroke,4,Y.FLOAT,!1,0,0),Y.bindBuffer(Y.ARRAY_BUFFER,Y.createBuffer()),Y.enableVertexAttribArray(M.vFill),Y.bufferData(Y.ARRAY_BUFFER,j,Y.DYNAMIC_DRAW),Y.vertexAttribPointer(M.vFill,4,Y.FLOAT,!1,0,0),Y.bindBuffer(Y.ELEMENT_ARRAY_BUFFER,Y.createBuffer()),Y.bufferData(Y.ELEMENT_ARRAY_BUFFER,K,Y.DYNAMIC_DRAW),Y.drawElements(Y.POINTS,4e4,Y.UNSIGNED_SHORT,0)}}function R(){}function F(){}function E(){m.call(this,this.attr.d),this.buffer=toBuffer(this.path.coords)}function B(t,n){var r=e.__scene__,i=r.indexOf(n);reverseEach(r.slice(i,r.push(0)),function(t,e){r[e]=r[e-1]}),r[i]=t}function P(t){return oe[t.tagName.toLowerCase()](t)}function k(t){var e=this.__scene__.indexOf(t);this.__scene__.splice(e,1),delete t.index,t.r(0)}function w(t){var n=this.buffer;e.__scene__.push(this);var r=4;this.attr=Object.create(ae),this.tagName=t.tagName,this.parentNode=this.parentElement=this,this.index=n.count*r,n[this.index]=n.count,n[this.index+1]=n.count,n[this.index+2]=n.count,n.count+=1}function L(t){ce[t]||(d3.select("canvas").on(t,function(){this.__scene__.filter(function(){})}),ce[t]=[]),ce[t].push(this.id)}function C(t){return D(t),S(t),R(t),F(t),V}function D(){Y.clear(Y.DEPTH_BUFFER_BIT|Y.STENCIL_BUFFER_BIT)}function T(){}function N(t,e){if(arguments.length>2)[].forEach.call(arguments,function(e){N(t,e)});else for(var n in e)t[n]=e[n];return t}function U(t,e,n){for(var r=t.length-1,i=0;r>i;)e.call(n,t[i++],t[i++])}function I(){return!1}function O(t,e){for(var n in t)e(t[n],n,t)}var Y,M,q;if(e="string"==typeof e?document.querySelector(e):e instanceof d3.selection?e.node():e,!e.getContext)return console.log(e,"is not a valid canvas");var V=!1,j=new Float32Array(4e4);t.shaderParameters={rgb:[0,0,0,0],translate:[0,0],time:[0],rotation:[0,1],opacity:[1],resolution:[0,0],scale:[1,1],stroke:[0],mouse:t.mouse=[0,0]},t.stop=function(){V=!0};var W,z={m:b,z:y,l:x,h:l,v:h,c:d,s:v,q:_,t:g,a:p},H=["precision mediump float;","attribute vec4 pos;","attribute vec4 fill;","attribute vec4 stroke;","varying vec4 v_stroke;","varying vec4 v_fill;","void main() {","    gl_Position.xy = pos.xy;","    gl_PointSize = pos.z * 2.;","    v_fill = fill;","    v_stroke = stroke;","}"].join("\n"),G=["precision mediump float;","varying vec4 v_stroke;","varying vec4 v_fill;","void main() {","    float dist = distance(gl_PointCoord, vec2(0.5));","    if (dist > 0.5) discard;","    gl_FragColor = dist > .4 ? v_stroke : v_fill;","}"].join("\n"),K=new Uint16Array(4e4),X=new Float32Array(4e4);K.count=0;var J={pos:{},fill:{},stroke:{}},Q=["precision mediump float;","attribute vec2 pos;","attribute vec4 stroke;","varying vec4 v_stroke;","void main() {","    gl_Position.xy = pos;","    v_stroke = stroke;","}"].join("\n"),Z=["precision mediump float;","varying vec4 v_stroke;","void main() {","    gl_FragColor = v_stroke;","}"].join("\n"),$=new Uint16Array(4e4);new Float32Array(4e4),$.size=0;d3.scale.linear().domain([0,e.width]).range([-1,1]),d3.scale.linear().domain([0,e.height]).range([1,-1]);var te=function(t){return 2*(t/e.width)-1},ee=function(t){return 1-2*(t/e.height)},ne={circle:{r:function(t){X[this.index+2]=t},cx:function(t){X[this.index+0]=te(t)},cy:function(t){X[this.index+1]=ee(t)},fill:function(t){var e=d3.rgb(t);j[this.index+0]=e.r/256,j[this.index+1]=e.g/256,j[this.index+2]=e.b/256,j[this.index+3]=this.attr.opacity},stroke:function(t){return},opacity:function(){j[this.index+3]=this.attr.opacity},buffer:K},ellipse:{cx:T,cy:T,rx:T,ry:T},rect:{width:T,height:T,x:T,y:T,rx:ie,ry:ie},image:{"xlink:href":T,height:T,width:T,x:T,y:T},line:{x1:function(t){this.buffer[this.index-4]=te(t)},y1:function(t){this.buffer[this.index-3]=ee(t)},x2:function(t){this.buffer[this.index-2]=te(t)},y2:function(t){this.buffer[this.index-1]=ee(t)},buffer:$},path:{d:E,pathLength:E},polygon:{points:T},polyline:{points:T},g:{appendChild:function(t){this.children.push(P(t))},ctr:function(){this.children=[]}},text:{x:T,y:T,dx:T,dy:T}};new Float32Array(1e6);var re=N(Object.create(null),{querySelectorAll:querySelectorAll,ctr:w,querySelector:function(t){return this.querySelectorAll(t)[0]},createElementNS:T,insertBefore:T,ownerDocument:{createElementNS:T},render:function(){this.buffer&&drawFill(this),drawStroke(this)},previousSibling:function(){e.scene[e.__scene__.indexOf()-1]},nextSibling:function(){e.scene[e.__scene__.indexOf()+1]},parent:function(){return __scene__},fill:function(t){I(t)&&initShader(d3.select(t).text(),t)},transform:function(t){var e=d3.transform(t),n=e.rotate*Math.PI/180;e.rotate&&delete e.translate,N(this.attr,e,{rotation:[Math.sin(n),Math.cos(n)]})},stroke:function(t){I(t)&&initShader(d3.select(t).text(),t)},getAttribute:function(t){return this.attr[t]},setAttribute:function(t,e){this.attr[t]=e,this[t]&&this[t](e)},style:{setProperty:T},removeAttribute:function(t){delete this.attr[t]},textContent:T,removeEventListener:T,addEventListener:L}),ie=T,oe=[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}].reduce(function(t,e){return t[e.name]=e.prototype=N(Object.create(re),ne[e.name]),t},{}),ae={rotation:[0,1],translate:[0,0],scale:[1,1],fill:0,stroke:0,"stroke-width":2,cx:0,cy:0,x:0,y:0,opacity:.999},ce={},se=(Date.now(),{});return t.frameCounter=se,n(e)}this.pathgl=t,t.stop=d3.functor()}();