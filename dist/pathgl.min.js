!function(){function e(){}function t(e){return e}function n(e){return[].push.call(this,e)}function i(e){return Math.pow(Math.ceil(Math.sqrt(e)),2)}function r(e,t){for(var n in e)t(e[n],n,e)}function o(){return[-1,-1,1,-1,-1,1,1,1]}function a(e){return e.split(".").pop().join().match(/mp4|ogg|webm/)}function s(e,t){if(arguments.length>2)[].forEach.call(arguments,function(t){s(e,t)});else for(var n in t)e[n]=t[n];return e}function u(e,t,n){!e||e.complete||4==e.readyState?t.call(n):e.addEventListener&&e.addEventListener("load",t.bind(n))}function c(e){var t=d(e);return+(255*t[0])<<16^255*t[1]<<8^255*t[2]<<0}function f(e){return e=Math.floor(e),[(255&e>>16)/255,(255&e>>8)/255,(255&e)/255]}function l(e,t,n){if(0===t)return[n,n,n];var i=.5>=n?n*(1+t):n+t-n*t,r=2*n-i;return[h(r,i,e+1/3),h(r,i,e),h(r,i,e-1/3)]}function h(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+6*(t-e)*(2/3-n):e}function d(e){if(_t[e])return f(_t[e]);if(/^hsl/i.test(e)){var t=e.split(/,|\(/).map(parseFloat);return l(t[1]/360,t[2]/100,t[3]/100)}if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var n=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return[Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255]}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var n=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return[Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100]}if(/^\#([0-9a-f]{6})$/i.test(e)){var n=/^\#([0-9a-f]{6})$/i.exec(e);return f(parseInt(n[1],16))}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var n=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return f(parseInt(n[1]+n[1]+n[2]+n[2]+n[3]+n[3],16))}return!1}function p(){function e(){for(var e=-1;++e<s;)c.update()}function t(e){c.drawTo(e)}function n(){return c.mergeProgram(St,Bt),this}function i(){lt.push(e),a.forEach(function(e){e.invalidate()})}function r(){return this}function o(e){return a.push(e),u}var a=[],s=2,u={read:t,map:n,match:r,pipe:o,invalidate:i},c=M({fbo:ht.createFramebuffer(),gl:ht,mesh:g()});return u}function g(){return C(ht,{pos:{array:o(),size:2},attrList:["pos"],count:4,primitive:"triangle_strip"})}function m(e,t,n,i){function r(t,n){var i,r=e.getUniformLocation(dt,t),o="uniform"+y(n)+"fv";dt[t]=function(t){i!=t&&arguments.length&&(e[o](r,Array.isArray(t)?t:[t]),i=t)}}var o=t+"\n"+n;dt=e.createProgram();var a=_(e,e.VERTEX_SHADER,t),s=_(e,e.FRAGMENT_SHADER,n);if(e.attachShader(dt,a),e.attachShader(dt,s),e.deleteShader(a),e.deleteShader(s),(i||["pos","color","fugue"]).forEach(function(t,n){e.bindAttribLocation(dt,n,t)}),e.linkProgram(dt),e.useProgram(dt),!e.getProgramParameter(dt,e.LINK_STATUS))throw name+": "+e.getProgramInfoLog(dt);for(var u=/uniform\s+(\S+)\s+(\S+)\s*;/g,c=null;null!=(c=u.exec(o));)r(c[2],c[1]);return dt.merge=x(a,s),dt.gl=e,dt}function v(e,t){r(t||{},function(e,t,n){"cx"==t&&(n.x=e),"cy"==t&&(n.y=e)});var n=s({stroke:"(color.r < 0.) ? vec4(stroke) : unpack_color(stroke)",r:"(pos.z < 0.) ? clamp(texel(pos.xy).w + texel(pos.xy).z, 1., 100.) : (2. * pos.z)",x:"(pos.x < 1.) ? texel(pos.xy).x * resolution.x : pos.x",y:"(pos.y < 1.) ? texel(pos.xy).y * resolution.y : pos.y"},t);for(var i in n)e=e.replace("replace_"+i,n[i]);return e}function _(e,t,n){var i="precision mediump float;\n",r=e.createShader(t);if(e.shaderSource(r,i+n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(r)||"",a=+o.split(":")[2];return console.error((n||"").split("\n").slice(a-5,a+5).join("\n"),o)}return r}function y(e){return e.match("vec")?e[e.length-1]:1}function x(){return function(e,t,n){return t=t||ut.fragmentShader,e=v(e,n),m(this.gl,e,t)}}function b(e){if(!(ht=S(canvas=e)))return!!console.log("webGL context could not be initialized");ht.getExtension("OES_texture_float")||console.warn("does not support floating point textures"),dt=m(ht,v(ut.vertexShader),ut.fragmentShader),canvas.program=dt,R(canvas),w(canvas);var t=M(canvas);return pt.push(t.update),ht.clearColor(.3,.3,.3,1),E(ht),D(),canvas}function E(e){e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE),e.blendColor(1,1,1,1)}function w(e){function t(){ut.uniform("resolution",[e.width||960,e.height||500])}setInterval(t,100),e.addEventListener("click",T),e.addEventListener("mousemove",A),e.addEventListener("touchmove",k),e.addEventListener("touchstart",k)}function T(){}function A(e){var t=canvas.getBoundingClientRect();ut.uniform("mouse",[e.clientX-t.left-canvas.clientLeft,e.clientY-t.top-canvas.clientTop])}function k(e){var t=canvas.getBoundingClientRect();e=e.touches[0],ut.uniform("mouse",[e.clientX-t.left-canvas.clientLeft,e.clientY-t.top-canvas.clientTop])}function R(e){window.d3&&s(window.d3.selection.prototype,{vAttr:B,shader:F}),window.d3&&s(window.d3.transition.prototype,{vAttr:B,shader:F}),s(e,yt).gl=ht}function S(e){var t=e.getContext("webgl")||e.getContext("experimental-webgl");return t&&s(t,{viewportWidth:e.width,viewportHeight:e.height})}function B(e,t){return this.each(function(e,n){this.colorBuffer[this.indices[0]]=c(t(e,n))}),this}function F(e){return this.node().mesh.mergeProgram(ut.vertexShader,ut.fragmentShader,e),this}function D(){for(var e,t=pt.length;t--;)pt[t]();for(e=lt,lt=[],bt=e;bt.length;)bt.pop()();xt(D)}function L(e){var t=[],n=this.buffer,i=this.posBuffer,r=this.indices,o=[0,0],a=r.length,s=0,u=[0,0];for(e.match(/[a-z][^a-z]*/gi).forEach(function(e){for(var n=e.slice(1).trim().split(/,| /g),i=e[0].toLowerCase(),r=0;r<n.length;){var a=n[r++],s=n[r++];"m"==i?u=o=[a,s]:"l"==i?t.push(o[0],o[1],a,s)&&(o=[a,s]):"z"==i?t.push(o[0],o[1],u[0],u[1])&&(o=u):console.log("%d method is not supported malformed path:",i)}});r.length<t.length;)r.push(n.count+s++);r.length>t.length&&(r.length=t.length),r.forEach(function(e,r){i[3*n[e]+e%3]=r<t.length&&t[r]}),n.count+=t.length-a}function z(){if(!d3)return console.warn("this method depends on d3");d3.selectAll("link[rel=styleSheet]").each(function(){d3.text});var e=d3.selectAll("style")[0].map(function(){return this.sheet}).reduce(function(e,t){var n={};return r(t.cssRules,function(e){for(var t=e.length,i={};t--;){var r=e[e[t]];i[r]=e[r]}n[e.selectorText]=i}),s(e,n)},{});r(e,function(e,t){d3.select(t).attr(e)})}function C(e,t){function n(){return p+="points"==t.primitive?1:"lines"==t.primitive?2:3}function i(){g.forEach(function(n,i){var r=e.createBuffer(),o=t[n]||{};e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,4e7,e.STREAM_DRAW),d[n]={array:new Float32Array(t[n]&&t[n].array||4e5),buffer:r,size:o.size||4,changed:!0,loc:i}})}function r(e){var t,n;for(n in d)for(n=d,t=n.size;t--;)d[e*n.size+t]=0}function o(e){e.posBuffer=d.pos.array,e.fBuffer=d.fugue.array,e.colorBuffer=d.color.array,e.mesh=this}function a(t){if(p){for(var n in d)n=d[n],e.bindBuffer(e.ARRAY_BUFFER,n.buffer),e.vertexAttribPointer(n.loc,n.size,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n.loc),n.changed&&e.bufferSubData(e.ARRAY_BUFFER,0,n.array);l(),e.drawArrays(m,t||0,p)}}function s(){}function u(){}function c(){}function f(){}function l(){for(var t=-1;++t<v.length;)e.bindTexture(e.TEXTURE_2D,v[t].texture)}function h(e,t){~v.indexOf(t)||v.push(t)}var d={},p=t.count||0,g=t.attrList||["pos","color","fugue"],m=e[t.primitive.toUpperCase()],v=[];return i(),{init:i,free:r,alloc:n,draw:a,bind:o,addTexture:h,bindMaterial:l,attributes:d,set:s,addAttr:u,removeAttr:c,boundingBox:f}}function M(e){function t(t){e.width=t.width,e.height=t.height,e.texture=t.texture,u=U.call(e)}function n(e){return(f[e.toLowerCase()]||console.log.bind(console,"oops"))(e)}function i(e,t,n){c=c.merge(e,t,n)}function r(){dt!=c&&s.useProgram(dt=c),s.bindFramebuffer(s.FRAMEBUFFER,u),o(),a(s),ut.uniform("clock",new Date-mt);for(var e=-1;++e<l.length;)l[e].draw()}function o(){for(var e in gt)dt[e]&&dt[e](gt[e])}function a(t){u||t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,e.width,e.height)}var s=e.gl,u=e.fbo||null,c=e.program||dt,f=e.types=W(),l=e.mesh?[e.mesh]:P(s,e.types);return l.forEach(function(e){e.mergeProgram=i}),u=U.call(e),e.__renderTarget__={update:r,append:n,drawTo:t,mergeProgram:i}}function P(e,t){var n=new C(e,{primitive:"points"});n.bind(t.circle),n.bind(t.rect);var i=new C(e,{primitive:"lines",pos:{size:2}});return i.bind(t.line),[n,i]}function U(){return this.fbo&&this.texture?(ht.bindFramebuffer(ht.FRAMEBUFFER,this.fbo),this.fbo.width=screen.width,this.fbo.height=screen.height,ht.framebufferTexture2D(ht.FRAMEBUFFER,ht.COLOR_ATTACHMENT0,ht.TEXTURE_2D,this.texture,null),ht.bindFramebuffer(ht.FRAMEBUFFER,null),this.fbo):void 0}function q(e,t){return e.replace(/^\s+|\s*([,\s\+\~>]|$)\s*/g,"$1").split(",").forEach(function(e){I(e,this).forEach(n.bind(t=[]))},this)||t}function I(e,t){var n,i=e.split(/[\s\>\+\~](?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),r=e.match(/([\s\>\+\~])(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),o=G(i.pop()),a=[],s=[];return H.call(t,o[1]||"*").forEach(function(e){(n=O.apply(e,o))&&a.push(n)}),i.length?a.forEach(function(e){N(e,i,r)&&s.push(e)})||s:a}function N(e,t,n,i){return i=function r(e,o,a){for(;a=wt[n[o]](a,e);)if(O.apply(a,G(t[o]))&&o)return(i=r(a,o-1,a))?i:a}(e,t.length-1,e)}function O(e,t,n,i,r,o,a,e,s,e,u,c){return s&&Et[s]&&!Et[s](this,u)||t&&"*"!==t&&this.tag&&this.tag.toLowerCase()!==t||i&&!$(o,this.attr[r]||"",a)||n&&(c=n.match(/#([\w\-]+)/))&&c[1]!==this.attr.id||n&&(n.match(/\.[\w\-]+/g)||[]).some(Y.bind(this))?0:this}function $(e,t,n){return t.match(RegExp({"=":n,"^=":"^"+j(n),"$=":j(n)+"$","*=":j(n),"~=":"(?:^|\\s+)"+j(n)+"(?:\\s+|$)","|=":"^"+j(n)+"(-|$)"}[e]||"adnan^"))}function G(e){return e.match(Tt)}function X(e){for(;e=e.previousSibling();)if(e.top)return e}function j(e){return e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/,"\\$1")}function Y(e){return!RegExp("(^|\\s+)"+e.slice(1)+"(\\s+|$)").test(this.attr.class)}function H(e){return V(this,function(t){return"*"==e||t.tagName==e},[])}function V(e,t,n){return(e.__scene__||e.children).forEach(function(e){V(e,t,n),t(e)&&n.push(e)})||n}function W(){return Rt.reduce(function(e,t){return e[t.name]=function n(){var e=Object.create(t.prototype);return s(e,n),e.init(n.mesh.alloc()-1),e.attr={},e},s(t.prototype,kt,At[t.name]),e},{})}function K(e){L.call(this,e,this.stroke(this.attr.stroke)),this.stroke(this.attr.stroke)}function J(e,t){var n=canvas.__scene__,i=n.indexOf(t);reverseEach(n.slice(i,n.push(0)),function(e,t){n[t]=n[t-1]}),n[i]=e}function Q(e){return this.__scene__[this.__scene__.length]=this.__renderTarget__.append(e.tagName)}function Z(e){var t=this.__scene__.indexOf(e);e=this.__scene__.splice(t,1)[0],e&&e.mesh.free(t)}function et(e){this.width=e.width||512,this.height=e.height||512,"string"==typeof e&&(e=nt(e)),"number"==typeof e&&(this.width=this.height=Math.sqrt(e),e=!1),s(this,{gl:ht,id:ct(),data:e,dependents:[],texture:ht.createTexture(),invalidate:function(){lt.push(function(){this.forEach(function(e){e.invalidate()})}.bind(this.dependents))}}),Array.isArray(e)&&(at.call(this,e),e=vt),this.load()}function tt(){ht.bindTexture(ht.TEXTURE_2D,this.texture),ht.pixelStorei(ht.UNPACK_FLIP_Y_WEBGL,!0),ht.texParameteri(ht.TEXTURE_2D,ht.TEXTURE_MAG_FILTER,ht.NEAREST),ht.texParameteri(ht.TEXTURE_2D,ht.TEXTURE_MIN_FILTER,ht.NEAREST),ht.texParameteri(ht.TEXTURE_2D,ht.TEXTURE_WRAP_S,ht.CLAMP_TO_EDGE),ht.texParameteri(ht.TEXTURE_2D,ht.TEXTURE_WRAP_T,ht.CLAMP_TO_EDGE),this.update()}function nt(e){var t=document.querySelector(e);return t?t:s(a?new Image:document.createElement("video"),{src:e})}function it(e){return this.dependents.push(e),e.read(this),this}function rt(){for(var e=this.size()||0,t=new Array(e);e--;)t[e]={x:this.x()(e,e),y:this.y(e,e)(e,e),z:this.z(e,e)(e,e)};return t}function ot(){this.fbo=ht.createFramebuffer(),this.__renderTarget__=M(this);var e=this.update;this.update=function(){e.call(this),this.__renderTarget__.update()}}function at(e,t){t=t||4096,e.forEach(function(t,n){e[n]=nt(e[n]),e[n].o})}function st(e,t){return Math.random()*(t-e)}var ut=this.pathgl={};ut.sim={},ut.stop=function(){},ut.context=function(){return ht};var ct=function(e){return function(){return e++}}(1),ft=0,lt=[];ut.texture=function(e){return ft||ut.init("canvas"),new et(e||!1)},ut.uniform=function(e,t){return 1==arguments.length?gt[e]:gt[e]=t},ut.applyCSS=z,HTMLCanvasElement.prototype.appendChild=function(e){return ut.init(this)?this.appendChild(e):void 0};var ht,dt,pt=[],gt={},mt=Date.now();ut.init=function(e){return ft=1,e="string"==typeof e?document.querySelector(e):e instanceof d3.selection?e.node():e,e.getContext?!!b(e):console.log(e,"is not a valid canvas")};var vt=function(){var e,t,n=document.createElement("canvas").getContext("2d");for(n.canvas.width=n.canvas.height=128,e=0;e<n.canvas.height;e+=16)for(t=0;t<n.canvas.width;t+=16)n.fillStyle=16&(t^e)?"#FFF":"#DDD",n.fillRect(t,e,16,16);return n.canvas}(),_t={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ut.shader=p,ut.vertexShader=["uniform float clock;","uniform vec2 mouse;","uniform vec2 resolution;","uniform vec2 dates;","attribute vec4 pos;","attribute vec4 color;","attribute vec4 fugue;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","uniform sampler2D texture;","uniform mat4 textureHello;","const mat4 modelViewMatrix = mat4(1.);","const mat4 projectionMatrix = mat4(1.);","vec4 texel(vec2 get) { return texture2D(texture, abs(get)); }","vec4 unpack_color(float col) {","    return vec4(mod(col / 256. / 256., 256.),","                mod(col / 256. , 256.),","                mod(col, 256.),","                256.)","                / 256.;","}","void main() {","    float time = clock / 1000.;","    float x = replace_x;","    float y = replace_y;","    float fill = color.x;","    float stroke = color.x;","    type = fugue.x;","    gl_PointSize =  replace_r;","    v_fill = unpack_color(fill);","    v_stroke = replace_stroke;","    gl_Position = vec4(2. * (x / resolution.x) - 1., 1. - ((y / resolution.y) * 2.),  1., 1.);","}"].join("\n\n"),ut.fragmentShader=["uniform sampler2D texture;","uniform vec2 resolution;","uniform vec2 dates;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","void main() {","    float dist = distance(gl_PointCoord, vec2(0.5));","    if (type == 1. && dist > 0.5) discard;","    gl_FragColor = (v_stroke.x < 0.) ? texture2D(texture, gl_PointCoord) : v_stroke;","}"].join("\n");var yt={appendChild:Q,querySelectorAll:q,querySelector:function(e){return this.querySelectorAll(e)[0]},removeChild:Z,insertBefore:J,__scene__:[],__program__:void 0},xt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},bt=[],Et={},wt={" ":function(e){return e&&e!==__scene__&&e.parent()},">":function(e,t){return e&&e.parent()==t.parent()&&e.parent()},"~":function(e){return e&&e.previousSibling()},"+":function(e,t,n,i){return!e||(n=X(e))&&(i=X(t))&&n==i&&n}},Tt=/^(\*|\w+)?(?:([\.\#]+[\w\-\.#]+)?)(\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\])?(:([\w\-]+)(\(['"]?([^()]+)['"]?\))?)?/,At={circle:{init:function(e){this.fBuffer[4*e]=1,this.indices=[4*e]},cx:function(e){this.posBuffer[this.indices[0]+0]=e},cy:function(e){this.posBuffer[this.indices[0]+1]=e},r:function(e){this.posBuffer[this.indices[0]+2]=e},cz:function(e){this.posBuffer[this.indices[0]+3]=e},fill:function(e){this.colorBuffer[this.indices[0]]=0>e?e:c(e)},stroke:function(e){this.colorBuffer[this.indices[0]]=c(e)},opacity:function(){},tagName:"circle",schema:"cx cy r cz".split(" ")},ellipse:{init:function(){},tagName:"ellipse",cx:e,cy:e,rx:e,ry:e},rect:{init:function(e){this.fBuffer[4*e]=0,this.indices=[4*e]},tagName:"rect",fill:function(e){this.colorBuffer[this.indices[0]]=0>e?e:c(e)},x:function(e){this.posBuffer[this.indices[0]+0]=e},y:function(e){this.posBuffer[this.indices[0]+1]=e},width:function(e){this.posBuffer[this.indices[0]+2]=e},height:function(e){this.posBuffer[this.indices[0]+3]=e},rx:e,ry:e},image:{init:function(){},tagName:"image","xlink:href":e,height:e,width:e,x:e,y:e},line:{init:function(e){this.indices=[2*e,2*e+1]},tagName:"line",x1:function(e){this.posBuffer[2*this.indices[0]]=e},y1:function(e){this.posBuffer[2*this.indices[0]+1]=e},x2:function(e){this.posBuffer[2*this.indices[1]]=e},y2:function(e){this.posBuffer[2*this.indices[1]+1]=e},stroke:function(e){var t=c(e);this.indices.forEach(function(e){this.colorBuffer[4*e]=parseInt(t.toString().slice(1),16)},this)}},path:{init:function(){},tagName:"path",d:K,pathLength:e,stroke:function(e){var t=c(e);this.indices.forEach(function(e){this.colorBuffer[e]=+parseInt(t.toString().slice(1),16)},this)}},polygon:{init:function(){},tagName:"polygon",points:e},polyline:{init:function(e){this.indices=[2*e,2*e+1]},tagName:"polyline",points:e},g:{init:function(){},tagName:"g",appendChild:function(e){this.children.push(Q(e))},ctr:function(){this.children=[]}},text:{init:function(){},tagName:"text",x:e,y:e,dx:e,dy:e}},kt={querySelectorAll:q,children:Object.freeze([]),querySelector:function(e){return this.querySelectorAll(e)[0]},createElementNS:t,insertBefore:e,ownerDocument:{createElementNS:function(e,t){return t}},previousSibling:function(){canvas.scene[canvas.__scene__.indexOf(this)-1]},nextSibling:function(){canvas.scene[canvas.__scene__.indexOf()+1]},parent:function(){return __scene__},gl:ht,transform:function(){},getAttribute:function(e){return this.attr[e]},setAttribute:function(e,t){this.attr[e]=t,this[e]&&this[e](t),t&&t.adnan&&this.mesh.addTexture(e,t)},style:{setProperty:e},removeAttribute:function(e){delete this.attr[e]},textContent:e,removeEventListener:e,addEventListener:addEventListener,ownerSVGElement:{createSVGPoint:function(){}}},Rt=[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}];et.prototype={init:tt,update:function(e){this.data?ht.texImage2D(ht.TEXTURE_2D,0,ht.RGBA,ht.RGBA,ht.UNSIGNED_BYTE,e||this.data):ht.texImage2D(ht.TEXTURE_2D,0,ht.RGBA,this.width,this.height,0,ht.RGBA,ht.FLOAT,null)},size:function(e,t){return arguments.length?(t||(this.height=e),this.w=e,this):this.width*this.height},z:function(){var e=Math.sqrt(this.size());return function(t,n){return-1/e*~~(n%e)}},x:function(){var e=Math.sqrt(this.size());return function(t,n){return-1/e*~~(n%e)}},y:function(){var e=Math.sqrt(this.size());return function(t,n){return-1/e*~~(n/e)}},load:function(){var e=this.data;return this.init(),this.update(vt),u(e,this.update,this),this},subImage:function(e,t,n){ht.texSubImage2D(ht.TEXTURE_2D,0,e,t,n.length/4,1,ht.RGBA,ht.FLOAT,n)},repeat:function(){return this.task=function(){this.update()}.bind(this),pt.push(this.task),this},stop:function(){this.task&&pt.splice(pt.indexOf(this.task)),delete this.task},appendChild:function(e){return this.__renderTarget__||ot.call(this),this.__scene__[this.__scene__.length]=this.__renderTarget__.append(e.tagName||e)},valueOf:function(){return-this.id},copy:function(){return ut.texture(this.src)},pipe:it,querySelectorAll:q,__scene__:[],ownerDocument:{createElementNS:function(e,t){return t}},unwrap:rt,adnan:!0};var St=["attribute vec2 pos;","  void main() {","  gl_Position = vec4(pos.xy, 1.0 , 1.0);","  }"].join("\n"),Bt=["uniform sampler2D texture;","uniform vec2 resolution;","uniform vec2 mouse;","uniform vec2 dimensions;","uniform float gravity;","uniform float inertia;","uniform float drag;","void main() {","vec2 TARGET = vec2(mouse / resolution);","vec4 data = texture2D(texture, (gl_FragCoord.xy) / dimensions);","vec2 pos = data.xy;","vec2 vel = data.zw;","if (pos.x > 1.) { vel.x *= -1.; pos.x = 1.; } ","if (pos.y > 1.) { vel.y *= -1.; pos.y = 1.; } ","if (pos.x < 0.) { vel.x *= -1.; pos.x = 0.; } ","if (pos.y < 0.) { vel.y *= -1.; pos.y = 0.; } ","pos += vel  * .005 / sqrt(distance(pos, TARGET));","vel += gravity * normalize(TARGET - pos) * inertia;","vel *= drag;","gl_FragColor = vec4(pos, vel);","}"].join("\n");Date.now(),ut.sim.particles=function(e){function t(){ut.uniform("gravity",-1*ut.uniform("gravity"))}function n(){ut.uniform("dimensions",[u,c]),ut.uniform("gravity",1),ut.uniform("inertia",.05),ut.uniform("drag",.991);for(var e=-1;++e<10;)o(a/10,[1,2].map(Math.random))}function r(e,t){o(t||a*Math.random(),e||[0,0])}function o(e,t){var n=~~(f%u),i=~~(f/c),r=[{x:n,y:i,size:e}];!function o(e){var t=e.x+e.size,n=t-u;u>t||(e.size-=n,r.push(e={x:0,y:(e.y+1)%c,size:n}),o(e))}(r[0]),r.forEach(function(e){for(var n=[],i=-1;++i<e.size;)n.push(t[0],t[1],st(-1,1),st(-1,1));l.subImage(e.x,e.y,new Float32Array(n))}),f+=e,f%=a}var a=i(e),u=Math.sqrt(a),c=u,f=0,l=ut.texture(a),h=ut.shader().map(Bt);return l.pipe(h),h.pipe(l).invalidate(),n(),s(l,{emit:r,reverse:t})}}();