!function(){function t(e){function n(n){return e=n,te=e.programs=e.programs||{},t.shaderParameters.resolution=[e.width,e.height],Q=f(e),a(e),i(e),r(e),d3.timer(W),(te.point=u(oe,ae)).name="point",(te.line=u(fe,le)).name="line",Q?e:null}function r(){Q.disable(Q.SCISSOR_TEST),Q.colorMask(!0,!0,!0,!0),Q.stencilMask(1,1,1,1),Q.disable(Q.BLEND),Q.enable(Q.CULL_FACE)}function i(t){d3.select(t).on("mousemove.pathgl",o)}function o(){var e=d3.mouse(this);t.mouse=[e[0]/innerWidth,e[1]/innerHeight]}function a(t){return G(t,{appendChild:$,querySelectorAll:F,querySelector:function(t){return this.querySelectorAll(t)[0]},removeChild:q,insertBefore:M,gl:Q,__scene__:[],__pos__:[],__program__:void 0})}function c(t,e){var n=Q.createShader(t);if(Q.shaderSource(n,e),Q.compileShader(n),!Q.getShaderParameter(n,Q.COMPILE_STATUS))throw e+" "+Q.getShaderInfoLog(n);return n}function u(e,n){if(Z=Q.createProgram(),e=c(Q.VERTEX_SHADER,e),n=c(Q.FRAGMENT_SHADER,n),Q.attachShader(Z,e),Q.attachShader(Z,n),Q.deleteShader(e),Q.deleteShader(n),Q.linkProgram(Z),Q.useProgram(Z),!Q.getProgramParameter(Z,Q.LINK_STATUS))throw name+": "+Q.getProgramInfoLog(Z);return J(t.shaderParameters,s),Z.vPos=Q.getAttribLocation(Z,"pos"),Q.enableVertexAttribArray(Z.vPos),Z.vfill=Q.getAttribLocation(Z,"fill"),Q.enableVertexAttribArray(Z.vFill),Z.vStroke=Q.getAttribLocation(Z,"stroke"),Q.enableVertexAttribArray(Z.vStroke),Z}function s(t,e){var n=Q.getUniformLocation(Z,e);(Z["set"+e]=function(e){Q["uniform"+t.length+"fv"](n,Array.isArray(e)?e:[e])})(t)}function f(t){var e=t.getContext("webgl",{antialias:!1})||t.getContext("experimental-webgl");return e&&G(e,{viewportWidth:t.width,viewportHeight:t.height})}function l(){}function h(){}function d(){}function p(){}function v(){}function _(){}function g(){}function m(t){var e=[];return K(t,function(t,n){e.push([t,n,0])}),e}function A(t){var e=addToBuffer(this);if(e.length)return render();t.match(/[a-z][^a-z]*/gi).forEach(function(t,n,r){var i=ie[t[0].toLowerCase()],o=t.slice(1).trim().split(/,| /g);return[].push.apply(e.coords,m(o)),i?"closePath"==i.name&&r[n+1]?i.call(e,r[n+1]):("function"==typeof i?1==o.length?i.call(e):K(o,i,e):console.error(i+" "+t[0]+" is not yet implemented"),void 0):void 0});var n=toBuffer(this.path.coords);this.path.length=0,this.path.push(n)}function b(t,e){pos=[t,e]}function x(t){re=pos,y.apply(this,/m/i.test(t)?t.slice(1).trim().split(/,| /g):this.coords[0])}function y(t,e){this.push(t,e,0)}function E(){if(ce.count){"point"!==Z.name&&Q.useProgram(Z=te.point);for(var t in se)Q.bindBuffer(Q.ARRAY_BUFFER,se[t].buffer),Q.enableVertexAttribArray(se[t].vLoc),se[t].changed&&Q.bufferSubData(Q.ARRAY_BUFFER,se[t].list,Q.DYNAMIC_DRAW),Q.vertexAttribPointer(se[t].vLoc,se[t].length,Q.FLOAT,!1,0,0);Q.bindBuffer(Q.ARRAY_BUFFER,Q.createBuffer()),Q.enableVertexAttribArray(Z.vPos),Q.bufferData(Q.ARRAY_BUFFER,ue,Q.DYNAMIC_DRAW),Q.vertexAttribPointer(Z.vPos,4,Q.FLOAT,!1,0,0),Q.bindBuffer(Q.ARRAY_BUFFER,Q.createBuffer()),Q.enableVertexAttribArray(Z.vStroke),Q.bufferData(Q.ARRAY_BUFFER,ne,Q.DYNAMIC_DRAW),Q.vertexAttribPointer(Z.vStroke,4,Q.FLOAT,!1,0,0),Q.bindBuffer(Q.ARRAY_BUFFER,Q.createBuffer()),Q.enableVertexAttribArray(Z.vFill),Q.bufferData(Q.ARRAY_BUFFER,ne,Q.DYNAMIC_DRAW),Q.vertexAttribPointer(Z.vFill,4,Q.FLOAT,!1,0,0),Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,Q.createBuffer()),Q.bufferData(Q.ELEMENT_ARRAY_BUFFER,ce,Q.DYNAMIC_DRAW),Q.drawElements(Q.POINTS,4e4,Q.UNSIGNED_SHORT,0)}}function R(){}function S(){}function F(t,e){return t.replace(/^\s+|\s*([,\s\+\~>]|$)\s*/g,"$1").split(",").forEach(function(t){w(t,this).forEach(L.bind(e))},this,e=[])||T(e)}function w(t,e){var n,r=t.split(/[\s\>\+\~](?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),i=t.match(/([\s\>\+\~])(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),o=C(r.pop()),a=[],c=[];return I.call(e,o[1]||"*").forEach(function(t){(n=P.apply(t,o))&&a.push(n)}),r.length?a.forEach(function(t){B(t,r,i)&&c.push(t)})||c:a}function B(t,e,n,r){return r=function i(t,o,a){for(;a=pe[n[o]](a,t);)if(P.apply(a,C(e[o]))&&o)return(r=i(a,o-1,a))?r:a}(t,e.length-1,t)}function P(t,e,n,r,i,o,a,t,c,t,u,s){return c&&de[c]&&!de[c](this,u)||e&&"*"!==e&&this.tag&&this.tag.toLowerCase()!==e||r&&!k(o,this[i]||"",a)||n&&(s=n.match(/#([\w\-]+)/))&&s[1]!==this.id||n&&(n.match(/\.[\w\-]+/g)||[]).some(U.bind(this))?0:this}function k(t,e,n){return e.match(RegExp({"=":n,"^=":"^"+N(n),"$=":N(n)+"$","*=":N(n),"~=":"(?:^|\\s+)"+N(n)+"(?:\\s+|$)","|=":"^"+N(n)+"(-|$)"}[t]||"adnan^"))}function L(t){return this.push(t)}function C(t){return t.match(ve)}function D(t){for(;t=t.previousSibling();)if(t.top)return t}function N(t){return t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/,"\\$1")}function T(t){return t.filter(function(e,n){return t.indexOf(e)==n})}function U(t){return!RegExp("(^|\\s+)"+t.slice(1)+"(\\s+|$)").test(this.className)}function I(t){return O(this,function(e){return"*"==t||e.name==t},[])}function O(t,e,n){return(t.__scene__||t.children).forEach(function(t){O(t,e,n),e(t)&&n.push(t)})||n}function Y(){A.call(this,this.attr.d),this.buffer=toBuffer(this.path.coords)}function M(t,n){var r=e.__scene__,i=r.indexOf(n);reverseEach(r.slice(i,r.push(0)),function(t,e){r[e]=r[e-1]}),r[i]=t}function $(t){return xe[t.tagName.toLowerCase()](t)}function q(t){var e=this.__scene__.indexOf(t);this.__scene__.splice(e,1),delete t.index,t.r(0)}function V(t){return function(n){var r=new t,i=r.buffer;e.__scene__.push(r);var o=4;return r.attr=Object.create(ye),r.tagName=n.tagName,r.parentNode=r.parentElement=r,r.index=i.count*o,i[r.index]=i.count,i[r.index+1]=i.count,i[r.index+2]=i.count,i.count+=1,r}}function j(t){Ee[t]||(d3.select("canvas").on(t,function(){this.__scene__.filter(function(){})}),Ee[t]=[]),Ee[t].push(this.id)}function W(t){return z(t),E(t),R(t),S(t),ee}function z(){Q.clear(Q.DEPTH_BUFFER_BIT|Q.STENCIL_BUFFER_BIT)}function H(){}function G(t,e){if(arguments.length>2)[].forEach.call(arguments,function(e){G(t,e)});else for(var n in e)t[n]=e[n];return t}function K(t,e,n){for(var r=t.length-1,i=0;r>i;)e.call(n,t[i++],t[i++])}function X(){return!1}function J(t,e){for(var n in t)e(t[n],n,t)}var Q,Z,te;if(e="string"==typeof e?document.querySelector(e):e instanceof d3.selection?e.node():e,!e.getContext)return console.log(e,"is not a valid canvas");var ee=!1,ne=new Float32Array(4e4);t.shaderParameters={rgb:[0,0,0,0],translate:[0,0],time:[0],rotation:[0,1],opacity:[1],resolution:[0,0],scale:[1,1],stroke:[0],mouse:t.mouse=[0,0]},t.stop=function(){ee=!0};var re,ie={m:b,z:x,l:y,h:l,v:h,c:d,s:p,q:v,t:_,a:g},oe=["precision mediump float;","attribute vec4 pos;","attribute vec4 fill;","attribute vec4 stroke;","varying vec4 v_stroke;","varying vec4 v_fill;","void main() {","    gl_Position.xy = pos.xy;","    gl_PointSize = pos.z * 2.;","    v_fill = fill;","    v_stroke = stroke;","}"].join("\n"),ae=["precision mediump float;","varying vec4 v_stroke;","varying vec4 v_fill;","void main() {","    float dist = distance(gl_PointCoord, vec2(0.5));","    if (dist > 0.5) discard;","    gl_FragColor = dist > .4 ? v_stroke : v_fill;","}"].join("\n"),ce=new Uint16Array(4e4),ue=new Float32Array(4e4);ce.count=0;var se={pos:{},fill:{},stroke:{}},fe=["precision mediump float;","attribute vec2 pos;","attribute vec4 stroke;","varying vec4 v_stroke;","void main() {","    gl_Position.xy = pos;","    v_stroke = stroke;","}"].join("\n"),le=["precision mediump float;","varying vec4 v_stroke;","void main() {","    gl_FragColor = v_stroke;","}"].join("\n"),he=new Uint16Array(4e4);new Float32Array(4e4),he.size=0;var de={},pe={" ":function(t){return t&&t!==__scene__&&t.parent()},">":function(t,e){return t&&t.parent()==e.parent()&&t.parent()},"~":function(t){return t&&t.previousSibling()},"+":function(t,e,n,r){return!t||(n=D(t))&&(r=D(e))&&n==r&&n}},ve=/^(\*|\w+)?(?:([\.\#]+[\w\-\.#]+)?)(\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\])?(:([\w\-]+)(\(['"]?([^()]+)['"]?\))?)?/;d3.scale.linear().domain([0,e.width]).range([-1,1]),d3.scale.linear().domain([0,e.height]).range([1,-1]);var _e=function(t){return 2*(t/e.width)-1},ge=function(t){return 1-2*(t/e.height)},me={circle:{r:function(t){ue[this.index+2]=t},cx:function(t){ue[this.index+0]=_e(t)},cy:function(t){ue[this.index+1]=ge(t)},fill:function(t){var e=d3.rgb(t);ne[this.index+0]=e.r/256,ne[this.index+1]=e.g/256,ne[this.index+2]=e.b/256,ne[this.index+3]=this.attr.opacity},stroke:function(t){return},opacity:function(){ne[this.index+3]=this.attr.opacity},buffer:ce},ellipse:{cx:H,cy:H,rx:H,ry:H},rect:{width:H,height:H,x:H,y:H,rx:be,ry:be},image:{"xlink:href":H,height:H,width:H,x:H,y:H},line:{x1:function(t){this.buffer[this.index-4]=_e(t)},y1:function(t){this.buffer[this.index-3]=ge(t)},x2:function(t){this.buffer[this.index-2]=_e(t)},y2:function(t){this.buffer[this.index-1]=ge(t)},buffer:he},path:{d:Y,pathLength:Y},polygon:{points:H},polyline:{points:H},g:{appendChild:function(t){this.children.push($(t))},ctr:function(){this.children=[]}},text:{x:H,y:H,dx:H,dy:H}};new Float32Array(1e6);var Ae=G(Object.create(null),{querySelectorAll:F,ctr:V,querySelector:function(t){return this.querySelectorAll(t)[0]},createElementNS:H,insertBefore:H,ownerDocument:{createElementNS:H},render:function(){this.buffer&&drawFill(this),drawStroke(this)},previousSibling:function(){e.scene[e.__scene__.indexOf()-1]},nextSibling:function(){e.scene[e.__scene__.indexOf()+1]},parent:function(){return __scene__},fill:function(t){X(t)&&initShader(d3.select(t).text(),t)},transform:function(t){var e=d3.transform(t),n=e.rotate*Math.PI/180;e.rotate&&delete e.translate,G(this.attr,e,{rotation:[Math.sin(n),Math.cos(n)]})},stroke:function(t){X(t)&&initShader(d3.select(t).text(),t)},getAttribute:function(t){return this.attr[t]},setAttribute:function(t,e){this.attr[t]=e,this[t]&&this[t](e)},style:{setProperty:H},removeAttribute:function(t){delete this.attr[t]},textContent:H,removeEventListener:H,addEventListener:j}),be=H,xe=[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}].reduce(function(t,e){return t[e.name]=V(e),e.prototype=G(Object.create(Ae),me[e.name]),t},{}),ye={rotation:[0,1],translate:[0,0],scale:[1,1],fill:0,stroke:0,"stroke-width":2,cx:0,cy:0,x:0,y:0,opacity:.999},Ee={},Re=(Date.now(),{});return t.frameCounter=Re,n(e)}this.pathgl=t,t.stop=d3.functor()}();