!function(){function t(){}function e(t){return t}function n(t){return[].push.call(this,t)}function i(t){return t&&!(t&t-1)}function r(t){return Math.pow(Math.ceil(Math.sqrt(t)),2)}function o(t,e){for(var n in t)e(t[n],n,t)}function a(){return[-1,-1,1,-1,-1,1,1,1]}function s(t){return t.split(".").pop().join().match(/mp4|ogg|webm/)}function u(){return i(this.height)&&i(this.width)&&(this.data||{}).constructor!==HTMLVideoElement&&this.data}function c(t,e){if(arguments.length>2)[].forEach.call(arguments,function(e){c(t,e)});else for(var n in e)t[n]=e[n];return t}function f(t,e){!t||t.complete||4==t.readyState?e():t.addEventListener&&t.addEventListener("load",e)}function l(t){var e=g(t);return+(255*e[0])<<16^255*e[1]<<8^255*e[2]<<0}function h(t){return t=Math.floor(t),[(255&t>>16)/255,(255&t>>8)/255,(255&t)/255]}function d(t,e,n){if(0===e)return[n,n,n];var i=.5>=n?n*(1+e):n+e-n*e,r=2*n-i;return[p(r,i,t+1/3),p(r,i,t),p(r,i,t-1/3)]}function p(t,e,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?t+6*(e-t)*n:.5>n?e:2/3>n?t+6*(e-t)*(2/3-n):t}function g(t){if(we[t])return h(we[t]);if(/^hsl/i.test(t)){var e=t.split(/,|\(/).map(parseFloat);return d(e[1]/360,e[2]/100,e[3]/100)}if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(t)){var n=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(t);return[Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255]}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(t)){var n=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(t);return[Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100]}if(/^\#([0-9a-f]{6})$/i.test(t)){var n=/^\#([0-9a-f]{6})$/i.exec(t);return h(parseInt(n[1],16))}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t)){var n=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t);return h(parseInt(n[1]+n[1]+n[2]+n[2]+n[3]+n[3],16))}return!1}function m(){function t(){for(var t=-1;++t<u;)f.update()}function e(){}function n(){}function i(){}function r(){return f.mergeProgram(De,Le),this}function o(){pe.push(t),this.dependents.forEach(function(t){t.invalidate()})}function a(){return this}function s(t){return f.drawTo(t),t&&this.dependents.push(t),c}var u=2,c={scatter:e,reduce:i,scan:n,map:r,match:a,pipe:s,invalidate:o,dependents:[]},f=U({gl:ge,mesh:v()});return c}function v(){return P(ge,{pos:{array:a(),size:2},attrList:["pos"],count:4,primitive:"triangle_strip"})}function y(t,e,n,i){function r(e,n){var i,r=t.getUniformLocation(me,e),o="uniform"+w(n)+"fv";me[e]=function(e){i!=e&&arguments.length&&(t[o](r,Array.isArray(e)?e:[e]),i=e)}}var o=e+"\n"+n;me=t.createProgram(),me.shit=Math.random(0);var a=x(t,t.VERTEX_SHADER,e),s=x(t,t.FRAGMENT_SHADER,n);if(t.attachShader(me,a),t.attachShader(me,s),t.deleteShader(a),t.deleteShader(s),(i||["pos","color","fugue"]).forEach(function(e,n){t.bindAttribLocation(me,n,e)}),t.linkProgram(me),t.useProgram(me),!t.getProgramParameter(me,t.LINK_STATUS))throw name+": "+t.getProgramInfoLog(me);for(var u=/uniform\s+(\S+)\s+(\S+)\s*;/g,c=null;null!=(c=u.exec(o));)r(c[2],c[1]);return me.merge=E(a,s),me.gl=t,me}function _(t,e){o(e||{},function(t,e,n){"cx"==e&&(n.x=t),"cy"==e&&(n.y=t)});var n=c({stroke:"(color.r < 0.) ? vec4(stroke) : unpack_color(stroke)",r:"(pos.z < 0.) ? clamp(texel(pos.xy).w + texel(pos.xy).z, 1., 100.) : (2. * pos.z)",x:"(pos.x < 1.) ? texel(pos.xy).x * resolution.x : pos.x",y:"(pos.y < 1.) ? texel(pos.xy).y * resolution.y : pos.y"},e);for(var i in n)t=t.replace("replace_"+i,n[i]);return t}function x(t,e,n){var i="precision mediump float;\n",r=t.createShader(e);if(t.shaderSource(r,i+n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var o=t.getShaderInfoLog(r)||"",a=+o.split(":")[2];return console.error((n||"").split("\n").slice(a-5,a+5).join("\n"),o)}return r}function w(t){return t.match("vec")?t[t.length-1]:1}function E(){return function(t,e,n){return e=e||le.fragmentShader,t=_(t,n),y(this.gl,t,e)}}function b(t){if(!(ge=F(canvas=t)))return!!console.log("webGL context could not be initialized");ge.getExtension("OES_texture_float")||console.warn("does not support floating point textures"),me=y(ge,_(le.vertexShader),le.fragmentShader),canvas.program=me,B(canvas),A(canvas);var e=U(canvas);return e.drawTo(null),ve.push(e.update),ge.clearColor(.3,.3,.3,1),T(ge),z(),ve.push(function(){le.uniform("clock",new Date-_e)}),canvas}function T(t){t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE),t.blendColor(1,1,1,1)}function A(t){function e(){le.uniform("resolution",[t.width||960,t.height||500])}setInterval(e,100),t.addEventListener("click",k),t.addEventListener("mousemove",R),t.addEventListener("touchmove",S),t.addEventListener("touchstart",S)}function k(){}function R(t){var e=canvas.getBoundingClientRect();le.uniform("mouse",[t.clientX-e.left-canvas.clientLeft,t.clientY-e.top-canvas.clientTop])}function S(t){var e=canvas.getBoundingClientRect();t=t.touches[0],le.uniform("mouse",[t.clientX-e.left-canvas.clientLeft,t.clientY-e.top-canvas.clientTop])}function B(t){window.d3&&c(window.d3.selection.prototype,{vAttr:D,shader:L}),window.d3&&c(window.d3.transition.prototype,{vAttr:D,shader:L}),c(t,Ee).gl=ge}function F(t){var e=t.getContext("webgl")||t.getContext("experimental-webgl");return e&&c(e,{viewportWidth:t.width,viewportHeight:t.height})}function D(t,e){return this.each(function(t,n){this.colorBuffer[this.indices[0]]=l(e(t,n))}),this}function L(t){return this.node().mesh.mergeProgram(le.vertexShader,le.fragmentShader,t),this}function z(){for(var t,e=ve.length;e--;)ve[e]();for(t=pe,pe=[],Te=t;Te.length;)Te.pop()();be(z)}function C(t){var e=[],n=this.buffer,i=this.posBuffer,r=this.indices,o=[0,0],a=r.length,s=0,u=[0,0];for(t.match(/[a-z][^a-z]*/gi).forEach(function(t){for(var n=t.slice(1).trim().split(/,| /g),i=t[0].toLowerCase(),r=0;r<n.length;){var a=n[r++],s=n[r++];"m"==i?u=o=[a,s]:"l"==i?e.push(o[0],o[1],a,s)&&(o=[a,s]):"z"==i?e.push(o[0],o[1],u[0],u[1])&&(o=u):console.log("%d method is not supported malformed path:",i)}});r.length<e.length;)r.push(n.count+s++);r.length>e.length&&(r.length=e.length),r.forEach(function(t,r){i[3*n[t]+t%3]=r<e.length&&e[r]}),n.count+=e.length-a}function M(){if(!d3)return console.warn("this method depends on d3");d3.selectAll("link[rel=styleSheet]").each(function(){d3.text});var t=d3.selectAll("style")[0].map(function(){return this.sheet}).reduce(function(t,e){var n={};return o(e.cssRules,function(t){for(var e=t.length,i={};e--;){var r=t[t[e]];i[r]=t[r]}n[t.selectorText]=i}),c(t,n)},{});o(t,function(t,e){d3.select(e).attr(t)})}function P(t,e){function n(){return p+="points"==e.primitive?1:"lines"==e.primitive?2:3}function i(){g.forEach(function(n,i){var r=t.createBuffer(),o=e[n]||{};t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,4e7,t.STREAM_DRAW),d[n]={array:new Float32Array(e[n]&&e[n].array||4e5),buffer:r,size:o.size||4,changed:!0,loc:i}})}function r(t){var e,n;for(n in d)for(n=d,e=n.size;e--;)d[t*n.size+e]=0}function o(t){t.posBuffer=d.pos.array,t.fBuffer=d.fugue.array,t.colorBuffer=d.color.array,t.mesh=this}function a(e){if(p){for(var n in d)n=d[n],t.bindBuffer(t.ARRAY_BUFFER,n.buffer),t.vertexAttribPointer(n.loc,n.size,t.FLOAT,!1,0,0),t.enableVertexAttribArray(n.loc),n.changed&&t.bufferSubData(t.ARRAY_BUFFER,0,n.array);t.drawArrays(m,e||0,p)}}function s(){}function u(){}function c(){}function f(){}function l(){for(var e=-1;++e<v.length;)t.bindTexture(t.TEXTURE_2D,v[e].texture)}function h(t,e){~v.indexOf(e)||v.push(e)}var d={},p=e.count||0,g=e.attrList||["pos","color","fugue"],m=t[e.primitive.toUpperCase()],v=[];return i(),{init:i,free:r,alloc:n,draw:a,bind:o,addTexture:h,bindMaterial:l,attributes:d,set:s,addAttr:u,removeAttr:c,boundingBox:f}}function U(t){function e(e){return e?(u.push(q(e)),t.width=e.width,t.height=e.height,void 0):u.push(null)}function n(t){return(f[t.toLowerCase()]||console.log.bind(console,"oops"))(t)}function i(t,e,n){c=c.merge(t,e,n)}function r(){me!=c&&s.useProgram(me=c);for(var e=-1;++e<u.length;){s.bindFramebuffer(s.FRAMEBUFFER,u[e]),o(),a(s,t);for(var n=-1;++n<l.length;)l[n].draw()}}function o(){for(var t in ye)me[t]&&me[t](ye[t])}function a(t,e){e==t.canvas&&t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,e.width,e.height)}var s=t.gl,u=[],c=t.program||me,f=t.types=J(),l=t.mesh?[t.mesh]:I(s,t.types);return l.forEach(function(t){t.mergeProgram=i}),t.__renderTarget__={update:r,append:n,drawTo:e,mergeProgram:i}}function I(t,e){var n=new P(t,{primitive:"points"});n.bind(e.circle),n.bind(e.rect);var i=new P(t,{primitive:"lines",pos:{size:2}});return i.bind(e.line),[n,i]}function q(t){var e=ge.createFramebuffer();return ge.bindFramebuffer(ge.FRAMEBUFFER,e),e.width=t.width,e.height=t.height,ge.framebufferTexture2D(ge.FRAMEBUFFER,ge.COLOR_ATTACHMENT0,ge.TEXTURE_2D,t.texture,null),ge.bindFramebuffer(ge.FRAMEBUFFER,null),e}function N(t,e){return t.replace(/^\s+|\s*([,\s\+\~>]|$)\s*/g,"$1").split(",").forEach(function(t){O(t,this).forEach(n.bind(e=[]))},this)||e}function O(t,e){var n,i=t.split(/[\s\>\+\~](?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),r=t.match(/([\s\>\+\~])(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),o=j(i.pop()),a=[],s=[];return W.call(e,o[1]||"*").forEach(function(t){(n=X.apply(t,o))&&a.push(n)}),i.length?a.forEach(function(t){$(t,i,r)&&s.push(t)})||s:a}function $(t,e,n,i){return i=function r(t,o,a){for(;a=ke[n[o]](a,t);)if(X.apply(a,j(e[o]))&&o)return(i=r(a,o-1,a))?i:a}(t,e.length-1,t)}function X(t,e,n,i,r,o,a,t,s,t,u,c){return s&&Ae[s]&&!Ae[s](this,u)||e&&"*"!==e&&this.tag&&this.tag.toLowerCase()!==e||i&&!G(o,this.attr[r]||"",a)||n&&(c=n.match(/#([\w\-]+)/))&&c[1]!==this.attr.id||n&&(n.match(/\.[\w\-]+/g)||[]).some(V.bind(this))?0:this}function G(t,e,n){return e.match(RegExp({"=":n,"^=":"^"+H(n),"$=":H(n)+"$","*=":H(n),"~=":"(?:^|\\s+)"+H(n)+"(?:\\s+|$)","|=":"^"+H(n)+"(-|$)"}[t]||"adnan^"))}function j(t){return t.match(Re)}function Y(t){for(;t=t.previousSibling();)if(t.top)return t}function H(t){return t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/,"\\$1")}function V(t){return!RegExp("(^|\\s+)"+t.slice(1)+"(\\s+|$)").test(this.attr.class)}function W(t){return K(this,function(e){return"*"==t||e.tagName==t},[])}function K(t,e,n){return(t.__scene__||t.children).forEach(function(t){K(t,e,n),e(t)&&n.push(t)})||n}function J(){return Fe.reduce(function(t,e){return t[e.name]=function n(){var t=Object.create(e.prototype);return c(t,n),t.init(n.mesh.alloc()-1),t.attr={},t},c(e.prototype,Be,Se[e.name]),t},{})}function Q(t){C.call(this,t,this.stroke(this.attr.stroke)),this.stroke(this.attr.stroke)}function Z(t,e){var n=canvas.__scene__,i=n.indexOf(e);reverseEach(n.slice(i,n.push(0)),function(t,e){n[e]=n[e-1]}),n[i]=t}function te(t){return this.__scene__[this.__scene__.length]=this.__renderTarget__.append(t.tagName)}function ee(t){var e=this.__scene__.indexOf(t);t=this.__scene__.splice(e,1)[0],t&&t.mesh.free(e)}function ne(t){this.width=t.width||512,this.height=t.height||512,"string"==typeof t&&(t=re(t)),"number"==typeof t&&(this.width=this.height=Math.sqrt(t),t=!1),c(this,{gl:ge,id:he(),data:t,dependents:[],texture:ge.createTexture(),invalidate:function(){pe.push(function(){this.forEach(function(t){t.invalidate()})}.bind(this.dependents))}}),Array.isArray(t)&&(this.data=ue.call(this)),t.constructor==Object&&(t=ce(t)),this.load()}function ie(){var t=u.call(this),e=ge[t?"REPEAT":"CLAMP_TO_EDGE"],n=ge[t?"LINEAR":"NEAREST"];ge.bindTexture(ge.TEXTURE_2D,this.texture),ge.pixelStorei(ge.UNPACK_FLIP_Y_WEBGL,!0),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,n),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,n),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,e),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,e),this.update()}function re(t){try{var e=document.querySelector(t);if(e)return e}catch(n){}return c(s?new Image:document.createElement("video"),{crossOrigin:"anonymous",src:t})}function oe(t){return this.dependents.push(t),this}function ae(){for(var t=this.size()||0,e=new Array(t);t--;)e[t]={x:this.x()(t,t),y:this.y()(t,t),z:this.z()(t,t)};return e}function se(){c(this,{__scene__:[]})(this.__renderTarget__=U(this)).drawTo(this);var t=this.update;this.update=function(){t.call(this),this.__renderTarget__.update()}}function ue(){var t=this.data,e=t.rows,n=t.width,i=this.update.bind(this),r=document.createElement("canvas").getContext("2d"),o=n/e;return r.canvas.width=r.canvas.height=n,t.forEach(function(n,a){var s=re(t[a]),u=o*(a%e),c=o*~~(a/e);f(s,function(){r.drawImage(s,u,c,o,o),i()})},this),r.canvas}function ce(t){var e=new Float32Array(1024),n=0;for(var i in t){for(var r in t[i])e[n++]=t[i][r];n>1020&&(this.subImage(0,n,e),e=new Float32Array(1024))}}function fe(t,e){return Math.random()*(e-t)}var le=this.pathgl={};le.sim={},le.stop=function(){},le.context=function(){return ge};var he=function(t){return function(){return t++}}(1),de=0,pe=[];le.texture=function(t){return de||le.init("canvas"),new ne(t||!1)},le.uniform=function(t,e){return 1==arguments.length?ye[t]:ye[t]=e},le.applyCSS=M,HTMLCanvasElement.prototype.appendChild=function(t){return le.init(this)?this.appendChild(t):void 0};var ge,me,ve=[],ye={},_e=Date.now();le.init=function(t){return de=1,t="string"==typeof t?document.querySelector(t):t instanceof d3.selection?t.node():t,t.getContext?!!b(t):console.log(t,"is not a valid canvas")};var xe=function(){var t,e,n=document.createElement("canvas").getContext("2d"),i=n.canvas.width=n.canvas.height=128;for(t=0;i>t;t+=16)for(e=0;i>e;e+=16)n.fillStyle=16&(e^t)?"#FFF":"#DDD",n.fillRect(e,t,16,16);return n.canvas}(),we={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};le.shader=m,le.vertexShader=["uniform float clock;","uniform vec2 mouse;","uniform vec2 resolution;","uniform vec2 dates;","attribute vec4 pos;","attribute vec4 color;","attribute vec4 fugue;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","varying vec4 dim;","uniform sampler2D texture;","const mat4 modelViewMatrix = mat4(1.);","const mat4 projectionMatrix = mat4(1.);","vec4 texel(vec2 get) { return texture2D(texture, abs(get)); }","vec4 unpack_color(float col) {","    return vec4(mod(col / 256. / 256., 256.),","                mod(col / 256. , 256.),","                mod(col, 256.),","                256. - fugue.y)","                / 256.;","}","vec2 clipspace(vec2 pos) { return vec2(2. * (pos.x / resolution.x) - 1., 1. - ((pos.y / resolution.y) * 2.)); }","void main() {","    float time = clock / 1000.;","    float x = replace_x;","    float y = replace_y;","    float r = replace_r;","    float fill = color.x;","    float stroke = color.x;","    type = fugue.x;","    gl_PointSize =  r;","    v_fill = unpack_color(fill);","    dim = vec4(x, y, r, -r);","    v_stroke = replace_stroke;","    gl_Position = vec4(clipspace(vec2(x, y)),  1., 1.);","}"].join("\n\n"),le.fragmentShader=["uniform sampler2D texture;","uniform vec2 resolution;","uniform vec2 dates;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","varying vec4 dim;","vec2 clipspace(vec2 pos) { return vec2(2. * (pos.x / resolution.x) - .5, 1. - ((pos.y / resolution.y))); }","void main() {","    float dist = distance(gl_PointCoord, vec2(0.5));","    if (type == 1. && dist > 0.5) discard;","    gl_FragColor = (v_stroke.x < 0.) ? texture2D(texture, clipspace(dim.xy + (dim.zw * (gl_PointCoord - .5)))) : v_stroke;","}"].join("\n");var Ee={appendChild:te,querySelectorAll:N,querySelector:function(t){return this.querySelectorAll(t)[0]},removeChild:ee,insertBefore:Z,__scene__:[],__program__:void 0},be=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},Te=[],Ae={},ke={" ":function(t){return t&&t!==__scene__&&t.parent()},">":function(t,e){return t&&t.parent()==e.parent()&&t.parent()},"~":function(t){return t&&t.previousSibling()},"+":function(t,e,n,i){return!t||(n=Y(t))&&(i=Y(e))&&n==i&&n}},Re=/^(\*|\w+)?(?:([\.\#]+[\w\-\.#]+)?)(\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\])?(:([\w\-]+)(\(['"]?([^()]+)['"]?\))?)?/,Se={circle:{init:function(t){this.fBuffer[4*t]=1,this.indices=[4*t]},cx:function(t){this.posBuffer[this.indices[0]+0]=t},cy:function(t){this.posBuffer[this.indices[0]+1]=t},r:function(t){this.posBuffer[this.indices[0]+2]=t},cz:function(t){this.posBuffer[this.indices[0]+3]=t},fill:function(t){this.colorBuffer[this.indices[0]]=0>t?t:l(t)},stroke:function(t){this.colorBuffer[this.indices[0]]=l(t)},tagName:"circle",schema:"cx cy r cz".split(" ")},ellipse:{init:function(){},tagName:"ellipse",cx:t,cy:t,rx:t,ry:t},rect:{init:function(t){this.fBuffer[4*t]=0,this.indices=[4*t]},tagName:"rect",fill:function(t){this.colorBuffer[this.indices[0]]=0>t?t:l(t)},x:function(t){this.posBuffer[this.indices[0]+0]=t},y:function(t){this.posBuffer[this.indices[0]+1]=t},width:function(t){this.posBuffer[this.indices[0]+2]=t},height:function(t){this.posBuffer[this.indices[0]+3]=t},rx:t,ry:t},image:{init:function(){},tagName:"image","xlink:href":t,height:t,width:t,x:t,y:t},line:{init:function(t){this.indices=[2*t,2*t+1]},tagName:"line",x1:function(t){this.posBuffer[2*this.indices[0]]=t},y1:function(t){this.posBuffer[2*this.indices[0]+1]=t},x2:function(t){this.posBuffer[2*this.indices[1]]=t},y2:function(t){this.posBuffer[2*this.indices[1]+1]=t},stroke:function(t){var e=l(t);this.indices.forEach(function(t){this.colorBuffer[4*t]=parseInt(e.toString().slice(1),16)},this)}},path:{init:function(){},tagName:"path",d:Q,pathLength:t,stroke:function(t){var e=l(t);this.indices.forEach(function(t){this.colorBuffer[t]=+parseInt(e.toString().slice(1),16)},this)}},polygon:{init:function(){},tagName:"polygon",points:t},polyline:{init:function(t){this.indices=[2*t,2*t+1]},tagName:"polyline",points:t},g:{init:function(){},tagName:"g",appendChild:function(t){this.children.push(te(t))},ctr:function(){this.children=[]}},text:{init:function(){},tagName:"text",x:t,y:t,dx:t,dy:t}},Be={querySelectorAll:N,children:Object.freeze([]),querySelector:function(t){return this.querySelectorAll(t)[0]},createElementNS:e,insertBefore:t,ownerDocument:{createElementNS:function(t,e){return e}},previousSibling:function(){canvas.scene[canvas.__scene__.indexOf(this)-1]},nextSibling:function(){canvas.scene[canvas.__scene__.indexOf()+1]},parent:function(){return __scene__},gl:ge,opacity:function(t){this.fBuffer[this.indices[0]+1]=256-256*t},transform:function(){},getAttribute:function(t){return this.attr[t]},setAttribute:function(t,e){this.attr[t]=e,this[t]&&this[t](e),e&&e.adnan&&this.mesh.addTexture(t,e)},style:{setProperty:t},removeAttribute:function(t){delete this.attr[t]},textContent:t,removeEventListener:t,addEventListener:addEventListener,ownerSVGElement:{createSVGPoint:function(){}}},Fe=[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}];ne.prototype={update:function(t){this.data?ge.texImage2D(ge.TEXTURE_2D,0,ge.RGBA,ge.RGBA,ge.UNSIGNED_BYTE,t||this.data):ge.texImage2D(ge.TEXTURE_2D,0,ge.RGBA,this.width,this.height,0,ge.RGBA,ge.FLOAT,null)},size:function(t,e){return arguments.length?(this.width=t,this.height=e||t,this):this.width*this.height},z:function(){var t=Math.sqrt(this.size());return function(e,n){return-1/t*~~(n%t)}},x:function(){var t=Math.sqrt(this.size());return function(e,n){return-1/t*~~(n%t)}},y:function(){var t=Math.sqrt(this.size());return function(e,n){return-1/t*~~(n/t)}},load:function(){var t=this.data;return ie.call(this),this.update(xe),f(t,this.update.bind(this)),this},subImage:function(t,e,n){ge.bindTexture(ge.TEXTURE_2D,this.texture),ge.texSubImage2D(ge.TEXTURE_2D,0,t,e,n.length/4,1,ge.RGBA,ge.FLOAT,new Float32Array(n))},repeat:function(){return this.task=function(){this.update()}.bind(this),ve.push(this.task),this},stop:function(){this.task&&ve.splice(ve.indexOf(this.task)),delete this.task},appendChild:function(t){return this.__renderTarget__||se.call(this),this.__scene__[this.__scene__.length]=this.__renderTarget__.append(t.tagName||t)},valueOf:function(){return-this.id},copy:function(){return le.texture(this.src)},pipe:oe,querySelectorAll:N,ownerDocument:{createElementNS:function(t,e){return e}},unwrap:ae,adnan:!0};var De=["attribute vec2 pos;","  void main() {","  gl_Position = vec4(pos.xy, 1.0 , 1.0);","  }"].join("\n"),Le=["uniform sampler2D texture;","uniform vec2 resolution;","uniform vec2 mouse;","uniform vec2 dimensions;","uniform float gravity;","uniform float inertia;","uniform float drag;","uniform float clock;","void main() {","vec2 TARGET = vec2(mouse / resolution);","vec4 data = texture2D(texture, (gl_FragCoord.xy) / dimensions);","vec2 pos = data.xy;","vec2 vel = data.zw;","if (pos.x > 1.) { vel.x *= -1.; pos.x = 1.; } ","if (pos.y > 1.) { vel.y *= -1.; pos.y = 1.; } ","if (pos.x < 0.) { vel.x *= -1.; pos.x = 0.; } ","if (pos.y < 0.) { vel.y *= -1.; pos.y = 0.; } ","pos += inertia  * vel;","vel += gravity * normalize(TARGET - pos);","vel *= drag;","gl_FragColor = vec4(pos, vel);","}"].join("\n");Date.now(),le.sim.particles=function(t){function e(){le.uniform("gravity",-1*le.uniform("gravity"))}function n(){le.uniform("dimensions",[s,u]),le.uniform("gravity",.1),le.uniform("inertia",.005),le.uniform("drag",.991);for(var t=-1;++t<10;)o(a/10,[1,2].map(Math.random))}function i(t,e){o(e||a*Math.random(),t||[0,0])}function o(t,e){var n=~~(f%s),i=~~(f/u),r=[{x:n,y:i,size:t}];!function o(t){var e=t.x+t.size,n=e-s;s>e||(t.size-=n,r.push(t={x:0,y:(t.y+1)%u,size:n}),o(t))}(r[0]),r.forEach(function(t){for(var n=[],i=-1;++i<t.size;)n.push(e[0],e[1],fe(-1,1),fe(-1,1));l.subImage(t.x,t.y,n)}),f+=t,f%=a}var a=r(t),s=Math.sqrt(a),u=s,f=0,l=le.texture(a),h=le.shader().map(Le);return l.pipe(h),h.pipe(l),h.invalidate(),setTimeout(n,1e3),c(l,{emit:i,reverse:e})}}();