!function(){function e(t){function n(){}function r(e){return e}function o(e){return this.push(e)}function a(e,t){for(var n in e)t(e[n],n,e)}function s(){return[-1,-1,1,-1,-1,1,1,1]}function u(e){return e.split(".").pop().join().match(/mp4|ogg|webm/)}function c(e,t){if(arguments.length>2)[].forEach.call(arguments,function(t){c(e,t)});else for(var n in t)e[n]=t[n];return e}function f(e){var t=p(e);return+(255*t[0])<<16^255*t[1]<<8^255*t[2]<<0}function l(e){return e=Math.floor(e),[(255&e>>16)/255,(255&e>>8)/255,(255&e)/255]}function h(e,t,n){if(0===t)return[n,n,n];var i=.5>=n?n*(1+t):n+t-n*t,r=2*n-i;return[d(r,i,e+1/3),d(r,i,e),d(r,i,e-1/3)]}function d(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+6*(t-e)*(2/3-n):e}function p(e){if(st[e])return l(st[e]);if(/^hsl/i.test(e)){var t=e.split(/,|\(/).map(parseFloat);return h(t[1]/360,t[2]/100,t[3]/100)}if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var n=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return[Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255]}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var n=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return[Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100]}if(/^\#([0-9a-f]{6})$/i.test(e)){var n=/^\#([0-9a-f]{6})$/i.exec(e);return l(parseInt(n[1],16))}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var n=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return l(parseInt(n[1]+n[1]+n[2]+n[2]+n[3]+n[3],16))}return!1}function g(e,t,n,i){function r(t,n){var i,r=e.getUniformLocation(at,t),o="uniform"+_(n)+"fv";at[t]=function(t){i!=t&&arguments.length&&(e[o](r,Array.isArray(t)?t:[t]),i=t)}}var o=t+"\n"+n;if(at=e.createProgram(),t=v(e,e.VERTEX_SHADER,t),n=v(e,e.FRAGMENT_SHADER,n),e.attachShader(at,t),e.attachShader(at,n),e.deleteShader(t),e.deleteShader(n),(i||["pos","color","fugue"]).forEach(function(t,n){e.bindAttribLocation(at,n,t)}),e.linkProgram(at),e.useProgram(at),!e.getProgramParameter(at,e.LINK_STATUS))throw name+": "+e.getProgramInfoLog(at);for(var a=/uniform\s+(\S+)\s+(\S+)\s*;/g,s=null;null!=(s=a.exec(o));)r(s[2],s[1]);return at}function m(t){var n=e.vertexShader;a(t||{},function(e,t,n){"cx"==t&&(n.x=e),"cy"==t&&(n.y=e)});var i=c({stroke:"(color.r < 0.) ? vec4(stroke) : unpack_color(stroke)",r:"(pos.z < 0.) ? texture2D(texture, abs(pos.xy)).x * 10. : (2. * pos.z)",x:"(pos.x < 0.) ? texture2D(texture, abs(pos.xy)).x * resolution.x: pos.x",y:"(pos.y < 0.) ? texture2D(texture, abs(pos.xy)).y * resolution.y: pos.y"},t);for(var r in i)n=n.replace("replace_"+r,i[r]);return n}function v(e,t,n){var i=e.createShader(t);if(e.shaderSource(i,n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){var r=e.getShaderInfoLog(i)||"",o=+r.split(":")[2];return console.error((n||"").split("\n").slice(o-5,o+5).join("\n"),r)}return i}function _(e){return e.match("vec")?e[e.length-1]:1}function y(n){if(!(ot=A(t=n)))return!!console.log("webGL context could not be initialized");ot.floatingTexture=!!ot.getExtension("OES_texture_float"),e.context=d3.functor(ot),at=g(ot,m(),e.fragmentShader),t.program=at,T(t),x(t);var i=z(t);return ct.push(i.update),ot.clearColor(0,0,0,0),S(),t}function x(t){function n(){e.uniform("resolution",[t.width||960,t.height||500])}setInterval(n,100),t.addEventListener("click",E),t.addEventListener("mousemove",b),t.addEventListener("touchmove",w),t.addEventListener("touchstart",w)}function E(){}function b(n){var i=t.getBoundingClientRect();e.uniform("mouse",[n.clientX-i.left-t.clientLeft,n.clientY-i.top-t.clientTop])}function w(n){var i=t.getBoundingClientRect();n=n.touches[0],e.uniform("mouse",[n.clientX-i.left-t.clientLeft,n.clientY-i.top-t.clientTop])}function T(e){window.d3&&c(window.d3.selection.prototype,{pAttr:k,shader:R}),c(e,ht).gl=ot}function A(e){var t=e.getContext("webgl")||e.getContext("experimental-webgl");return t&&c(t,{viewportWidth:e.width,viewportHeight:e.height})}function k(e){return this.each(function(t){for(var n in e)this.posBuffer[this.indices[0]+this.schema.indexOf(n)]=e[n](t)}),pointsChanged=!0,this}function R(e){return this.node().mesh.mergeProgram(e),this}function S(){ct.forEach(function(e){e()}),e.raf=dt(S)}function B(e){var t=[],n=this.buffer,i=this.posBuffer,r=this.indices,o=[0,0],a=r.length,s=0,u=[0,0];for(e.match(/[a-z][^a-z]*/gi).forEach(function(e){for(var n=e.slice(1).trim().split(/,| /g),i=e[0].toLowerCase(),r=0;r<n.length;){var a=n[r++],s=n[r++];"m"==i?u=o=[a,s]:"l"==i?t.push(o[0],o[1],a,s)&&(o=[a,s]):"z"==i?t.push(o[0],o[1],u[0],u[1])&&(o=u):console.log("%d method is not supported malformed path:",i)}});r.length<t.length;)r.push(n.count+s++);r.length>t.length&&(r.length=t.length),r.forEach(function(e,r){i[3*n[e]+e%3]=r<t.length&&t[r]}),n.count+=t.length-a}function F(){if(!d3)return console.warn("this method depends on d3");d3.selectAll("link[rel=styleSheet]").each(function(){d3.text});var e=d3.selectAll("style")[0].map(function(){return this.sheet}).reduce(function(e,t){var n={};return a(t.cssRules,function(e){for(var t=e.length,i={};t--;){var r=e[e[t]];i[r]=e[r]}n[e.selectorText]=i}),c(e,n)},{});a(e,function(e,t){d3.select(t).attr(e)})}function D(e,t){function n(){return h+="points"==t.primitive?1:"lines"==t.primitive?2:3}function i(){d.forEach(function(n,i){var r=e.createBuffer(),o=t[n]||{};e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,4e7,e.STREAM_DRAW),l[n]={array:new Float32Array(t[n]&&t[n].array||4e5),buffer:r,size:o.size||4,changed:!0,loc:i}})}function r(e){var t,n;for(n in l)for(n=l,t=n.size;t--;)l[e*n.size+t]=0}function o(e){e.posBuffer=l.pos.array,e.fBuffer=l.fugue.array,e.colorBuffer=l.color.array,e.mesh=this}function a(t){if(h){for(var n in l)n=l[n],e.bindBuffer(e.ARRAY_BUFFER,n.buffer),e.vertexAttribPointer(n.loc,n.size,e.FLOAT,!1,0,0),e.enableVertexAttribArray(n.loc),n.changed&&e.bufferSubData(e.ARRAY_BUFFER,0,n.array);e.drawArrays(p,t||0,h)}}function s(){}function u(){}function c(){}function f(){}var l={},h=t.count||0,d=t.attrList||["pos","color","fugue"],p=e[t.primitive.toUpperCase()];return i(),{init:i,free:r,alloc:n,draw:a,bind:o,attributes:l,set:s,addAttr:u,removeAttr:c,boundingBox:f}}function z(t){function n(e){return(h[e.toLowerCase()]||console.log.bind(console,"oops"))(e)}function i(t){l=g(u,m(t),e.fragmentShader)}function r(){for(at!=l&&u.useProgram(at=l),u.bindFramebuffer(u.FRAMEBUFFER,f),a(),o(),s(u),e.uniform("clock",new Date-lt),c=-1;++c<d.length;)d[c].draw()}function o(){for(var e in ft)at[e]&&at[e](ft[e])}function a(){t.texture&&u.bindTexture(u.TEXTURE_2D,t.texture)}function s(e){f||e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,t.width,t.height)}var u=t.gl,c=0,f=t.fbo||null,l=t.program,h=t.types=Y(),d=L(u,t.types);return t.mesh&&d.push(t.mesh),d.forEach(function(e){e.mergeProgram=i}),C.call(t),t.__renderTarget__={update:r,append:n}}function L(e,t){var n=new D(e,{primitive:"points"});n.bind(t.circle),n.bind(t.rect);var i=new D(e,{primitive:"lines",pos:{size:2}});return i.bind(t.line),[n,i]}function C(){this.fbo&&(ot.bindFramebuffer(ot.FRAMEBUFFER,this.fbo),this.fbo.width=screen.width,this.fbo.height=screen.height,ot.framebufferTexture2D(ot.FRAMEBUFFER,ot.COLOR_ATTACHMENT0,ot.TEXTURE_2D,this.texture,null),ot.bindFramebuffer(ot.FRAMEBUFFER,null))}function M(e,t){return e.replace(/^\s+|\s*([,\s\+\~>]|$)\s*/g,"$1").split(",").forEach(function(e){U(e,this).forEach(o.bind(t=[]))},this)||t}function U(e,t){var n,i=e.split(/[\s\>\+\~](?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),r=e.match(/([\s\>\+\~])(?![\s\w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^'"]*\]|[\s\w\+\-]*\))/),o=N(i.pop()),a=[],s=[];return G.call(t,o[1]||"*").forEach(function(e){(n=q.apply(e,o))&&a.push(n)}),i.length?a.forEach(function(e){P(e,i,r)&&s.push(e)})||s:a}function P(e,t,n,i){return i=function r(e,o,a){for(;a=gt[n[o]](a,e);)if(q.apply(a,N(t[o]))&&o)return(i=r(a,o-1,a))?i:a}(e,t.length-1,e)}function q(e,t,n,i,r,o,a,e,s,e,u,c){return s&&pt[s]&&!pt[s](this,u)||t&&"*"!==t&&this.tag&&this.tag.toLowerCase()!==t||i&&!I(o,this[r]||"",a)||n&&(c=n.match(/#([\w\-]+)/))&&c[1]!==this.attr.id||n&&(n.match(/\.[\w\-]+/g)||[]).some(X.bind(this))?0:this}function I(e,t,n){return t.match(RegExp({"=":n,"^=":"^"+$(n),"$=":$(n)+"$","*=":$(n),"~=":"(?:^|\\s+)"+$(n)+"(?:\\s+|$)","|=":"^"+$(n)+"(-|$)"}[e]||"adnan^"))}function N(e){return e.match(mt)}function O(e){for(;e=e.previousSibling();)if(e.top)return e}function $(e){return e.replace(/([.*+?\^=!:${}()|\[\]\/\\])/,"\\$1")}function X(e){return!RegExp("(^|\\s+)"+e.slice(1)+"(\\s+|$)").test(this.attr.class)}function G(e){return j(this,function(t){return"*"==e||t.tagName==e},[])}function j(e,t,n){return(e.__scene__||e.children).forEach(function(e){j(e,t,n),t(e)&&n.push(e)})||n}function Y(){return yt.reduce(function(e,t){return e[t.name]=function n(){var e=Object.create(t.prototype);return c(e,n),e.init(n.mesh.alloc()-1),e.attr={},e},c(t.prototype,_t,vt[t.name]),e},{})}function H(e){B.call(this,e,this.stroke(this.attr.stroke)),this.stroke(this.attr.stroke)}function W(e,n){var i=t.__scene__,r=i.indexOf(n);reverseEach(i.slice(r,i.push(0)),function(e,t){i[t]=i[t-1]}),i[r]=e}function V(e){return this.__scene__[this.__scene__.length]=this.__renderTarget__.append(e.tagName)}function K(e){var t=this.__scene__.indexOf(e);e=this.__scene__.splice(t,1)[0],e&&e.mesh.free(t)}function J(e,t){c(this,{fbo:ot.createFramebuffer(),program:e||at,gl:ot,texture:ot.createTexture(),width:512,height:512,mesh:D(ot,{pos:{array:s(),size:2},attrList:["pos"],count:4,primitive:"triangle_strip"})},t),this.texture.unit=0,this.init(),this.__renderTarget__=z(this),this.start(),this.update=function(){this.step&&this.step(),this.__renderTarget__.update()}}function Q(t,n){if(!e.context().floatingTexture)return console.warn("does not support floating point textures");var r=g(ot,i,t,["pos"]);return c(n,{}),new J(r,n)}function Z(e,t){"string"==typeof e&&(e=tt(e)),c(this,{gl:ot,data:e,texture:ot.createTexture(),width:512,height:512},e,t).load()}function et(){ot.bindTexture(ot.TEXTURE_2D,this.texture),ot.pixelStorei(ot.UNPACK_FLIP_Y_WEBGL,!0),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MAG_FILTER,ot.NEAREST),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MIN_FILTER,ot.NEAREST),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_S,ot.CLAMP_TO_EDGE),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_T,ot.CLAMP_TO_EDGE),this.update()}function tt(e){var t=document.querySelector(e);return t?t:c(u?new Image:document.createElement("video"),{src:e})}function nt(e){return e.length>50}function it(){}function rt(){for(var e=new Array(this.size),t=this.size||0;t--;)e[t]={x:this.x()(t,t),y:this.y(t,t)(t,t)};return e}var ot,at;if(null==t&&(t=document.body.appendChild(c(document.createElement("canvas"),{height:500,width:960}))),t="string"==typeof t?document.querySelector(t):t instanceof d3.selection?t.node():t,!t)return console.log("invalid selector");if(!t.getContext)return console.log(t,"is not a valid canvas");var st={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};e.vertexShader=["precision mediump float;","uniform float clock;","uniform vec2 mouse;","uniform vec2 resolution;","uniform vec2 dates;","attribute vec4 pos;","attribute vec4 color;","attribute vec4 fugue;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","uniform sampler2D texture;","const mat4 modelViewMatrix = mat4(1.);","const mat4 projectionMatrix = mat4(1.);","vec4 unpack_color(float col) {","    return vec4(mod(col / 256. / 256., 256.),","                mod(col / 256. , 256.),","                mod(col, 256.),","                200.)","                / 256.;","}","void main() {","    float time = clock / 1000.;","    float x = replace_x;","    float y = replace_y;","    float fill = color.x;","    float stroke = color.x;","    gl_Position = vec4(2. * (x / resolution.x) - 1., 1. - ((y / resolution.y) * 2.),  1., 1.);","    type = fugue.x;","    gl_PointSize =  replace_r;","    v_fill = unpack_color(fill);","    v_stroke = replace_stroke;","}"].join("\n\n"),e.fragmentShader=["precision mediump float;","uniform sampler2D texture;","uniform vec2 resolution;","uniform vec2 dates;","varying float type;","varying vec4 v_stroke;","varying vec4 v_fill;","void main() {","    float dist = distance(gl_PointCoord, vec2(0.5));","    if (type == 1. && dist > 0.5) discard;","    gl_FragColor = (v_stroke.x < 0.) ? texture2D(texture, gl_PointCoord) : v_stroke;","}"].join("\n");var ut=!1,ct=[],ft={},lt=Date.now();e.stop=function(){ut=!0};var ht={appendChild:V,querySelectorAll:M,querySelector:function(e){return this.querySelectorAll(e)[0]},removeChild:K,insertBefore:W,__scene__:[],__pos__:[],__program__:void 0},dt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};e.uniform=function(e,t){return 1==arguments.length?ft[e]:(ft[e]=t,void 0)},e.applyCSS=F;var pt={},gt={" ":function(e){return e&&e!==__scene__&&e.parent()},">":function(e,t){return e&&e.parent()==t.parent()&&e.parent()},"~":function(e){return e&&e.previousSibling()},"+":function(e,t,n,i){return!e||(n=O(e))&&(i=O(t))&&n==i&&n}},mt=/^(\*|\w+)?(?:([\.\#]+[\w\-\.#]+)?)(\[([\w\-]+)(?:([\|\^\$\*\~]?\=)['"]?([ \w\-\/\?\&\=\:\.\(\)\!,@#%<>\{\}\$\*\^]+)["']?)?\])?(:([\w\-]+)(\(['"]?([^()]+)['"]?\))?)?/,vt={circle:{init:function(e){this.fBuffer[4*e]=1,this.indices=[4*e]},cx:function(e){this.posBuffer[this.indices[0]+0]=e},cy:function(e){this.posBuffer[this.indices[0]+1]=e},r:function(e){this.posBuffer[this.indices[0]+2]=e},cz:function(e){this.posBuffer[this.indices[0]+3]=e},fill:function(e){this.colorBuffer[this.indices[0]]=0>e?e:f(e)},stroke:function(e){this.colorBuffer[this.indices[0]]=f(e)},opacity:function(){},tagName:"circle"},ellipse:{init:function(){},tagName:"ellipse",cx:n,cy:n,rx:n,ry:n},rect:{init:function(e){this.fBuffer[4*e]=0,this.indices=[4*e]},tagName:"rect",fill:function(e){this.colorBuffer[this.indices[0]]=0>e?e:f(e)},x:function(e){this.posBuffer[this.indices[0]+0]=e},y:function(e){this.posBuffer[this.indices[0]+1]=e},width:function(e){this.posBuffer[this.indices[0]+2]=e},height:function(e){this.posBuffer[this.indices[0]+3]=e},rx:n,ry:n},image:{init:function(){},tagName:"image","xlink:href":n,height:n,width:n,x:n,y:n},line:{init:function(e){this.indices=[2*e,2*e+1]},tagName:"line",x1:function(e){this.posBuffer[2*this.indices[0]]=e},y1:function(e){this.posBuffer[2*this.indices[0]+1]=e},x2:function(e){this.posBuffer[2*this.indices[1]]=e},y2:function(e){this.posBuffer[2*this.indices[1]+1]=e},stroke:function(e){var t=f(e);this.indices.forEach(function(e){this.colorBuffer[4*e]=parseInt(t.toString().slice(1),16)},this)}},path:{init:function(){},tagName:"path",d:H,pathLength:n,stroke:function(e){var t=f(e);this.indices.forEach(function(e){this.colorBuffer[e]=+parseInt(t.toString().slice(1),16)},this)}},polygon:{init:function(){},tagName:"polygon",points:n},polyline:{init:function(e){this.indices=[2*e,2*e+1]},tagName:"polyline",points:n},g:{init:function(){},tagName:"g",appendChild:function(e){this.children.push(V(e))},ctr:function(){this.children=[]}},text:{init:function(){},tagName:"text",x:n,y:n,dx:n,dy:n}},_t={querySelectorAll:M,children:Object.freeze([]),querySelector:function(e){return this.querySelectorAll(e)[0]},createElementNS:r,insertBefore:n,ownerDocument:{createElementNS:function(e,t){return t}},render:function(){this.buffer&&drawFill(this),drawStroke(this)},previousSibling:function(){t.scene[t.__scene__.indexOf(this)-1]},nextSibling:function(){t.scene[t.__scene__.indexOf()+1]},parent:function(){return __scene__},gl:ot,transform:function(){},getAttribute:function(e){return this.attr[e]},setAttribute:function(e,t){t.ctr==xt&&(t=+t),this.attr[e]=t,this[e]&&this[e](t)},style:{setProperty:n},removeAttribute:function(e){delete this.attr[e]},textContent:n,removeEventListener:n,addEventListener:n},yt=[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}];e.texture=function(e,t,n){return new(null==e?J:nt(e)?Q:Z)(e,c(t||{},{src:e}),n)};var xt={init:et,update:function(){ot.texImage2D(ot.TEXTURE_2D,0,ot.RGBA,ot.RGBA,ot.UNSIGNED_BYTE,this.data)},z:function(){var e=Math.sqrt(this.size);return function(t,n){return-1/e*~~(n%e)}},x:function(){var e=Math.sqrt(this.size);return function(t,n){return-1/e*~~(n%e)}},y:function(){var e=Math.sqrt(this.size);return function(t,n){return-1/e*~~(n/e)}},forEach:function(){},load:function(){var e=this.data;return e.complete||4==e.readyState?this.init():e.addEventListener&&e.addEventListener("load",this.init),this},repeat:function(){return this.task=this.update.bind(this),ct.push(this.task),this},stop:function(){this.task&&ct.splice(ct.indexOf(this.task)),delete this.task},appendChild:function(e){return this.__scene__[this.__scene__.length]=this.__renderTarget__.append(e.tagName||e)},valueOf:function(){return-1},copy:function(){return e.texture(this.src)},pipe:it,querySelectorAll:M,__scene__:[],ownerDocument:{createElementNS:function(e,t){return t}},unwrap:rt};return c(J.prototype,ht,xt,{update:function(){ot.texImage2D(ot.TEXTURE_2D,0,ot.RGBA,this.width,this.height,0,ot.RGBA,ot.FLOAT,this.data||null)}}),c(Z.prototype,xt,{}),y(t)}function t(e,t){return Math.random()*(t-e)}function n(e){return[2*(e[0]/960)-1,1-2*(e[1]/500)]}HTMLCanvasElement.prototype.appendChild=function(){},this.pathgl=e,e.stop=function(){},e.context=function(){},e.uniform=function(){},e.texture=function(){};var i=["precision mediump float;","attribute vec2 pos;","  void main() {","  gl_Position = vec4( pos.xy, 1.0 , 1.0);","  }"].join("\n"),r=[,"precision mediump float;","uniform sampler2D texture;","uniform vec2 resolution;","uniform vec2 mouse;","uniform vec2 dimensions;","vec4 texelAtOffet( vec2 offset ) { return texture2D(texture, (gl_FragCoord.xy + offset) / dimensions); }","void main() {","vec3 TARGET = vec3(mouse / resolution, 0.01 );","int slot = int( mod( gl_FragCoord.x, 2.0 ) );","if ( slot == 0 ) { ","vec4 dataA = texelAtOffet( vec2( 0, 0 ) );","vec4 dataB = texelAtOffet( vec2( 1, 0 ) );","vec3 pos = dataA.xyz;","vec3 vel = dataB.xyz;","float phase = dataA.w;","if ( phase > 0.0 ) {","pos += vel * 0.005;","if ( length( TARGET - pos ) < 0.035 ) phase = 0.0;","    else phase += 0.1;","} else {","    pos = vec3(-1);","}","    gl_FragColor = vec4( pos, phase );","} else if ( slot == 1 ) { ","vec4 dataA = texelAtOffet( vec2( -1, 0 ) );","vec4 dataB = texelAtOffet( vec2( 0, 0 ) );","vec3 pos = dataA.xyz;","vec3 vel = dataB.xyz;","float phase = dataA.w;","if ( phase > 0.0 ) {","vec3 delta = normalize( TARGET - pos );","vel += delta * 0.05;","    vel *= 0.991;","} else {","    vel = vec3(0);","}","    gl_FragColor = vec4( vel, 1.0 );","    }","}"].join("\n");e.sim={};var o=Date.now();e.sim.force=function(i){function a(){}function s(){var t=Date.now()-o,n=[-1+2*Math.sin(.001*t),-.2+.5*Math.cos(.004*t),Math.sin(.015*t)*-.05];e.uniform("dimensions",[l,h]),d3.select(window).on("mousemove.physics",u.bind(this)),c(this.gl,this.texture,4e4,n)}function u(){if(!(Date.now()-d<p)){var e=m*Math.random(),t=n(d3.mouse(g.node())).concat(0);d=Date.now(),c(this.gl,this.texture,e,t)}}function c(e,n,r,o,a){function s(e){var t=e.x+e.size;if(t>l){var n=t-l;e.size-=n,e={x:0,y:(e.y+1)%h,size:n},f.push(e),s(e)}}a=a||{x:0,y:0,z:0},e.activeTexture(e.TEXTURE0+n.unit),e.bindTexture(e.TEXTURE_2D,n);var u=~~(2*v%l),c=~~(v/h),f=[{x:u,y:c,size:2*r}];s(f[0]);var d,p,g,m,_,y,x=1;for(d=0,g=f.length;g>d;d++){for(_=f[d],y=[],p=0,m=_.size;m>p;p++)y.push(o[0],o[1],0,10*Math.random(),a.x+x*t(-1,1),a.y+x*t(-1,1),a.z+x*t(-1,1),0);e.texSubImage2D(e.TEXTURE_2D,0,_.x,_.y,_.size,1,e.RGBA,e.FLOAT,new Float32Array(y))}v+=r,v%=i}var f=new Float32Array(8*i),l=2*Math.sqrt(i),h=Math.sqrt(i),d=0,p=16,g=d3.select("canvas"),m=1e3,v=0;return e.texture(r,{step:a,data:f,width:l,height:h,size:i,start:s})}}();